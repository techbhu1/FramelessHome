rh._.exports({"0":[["n_havlan"]],"1":[[" ","5    ","Configuring High ","Availability VLANs","High availability (HA) VLANs, unlike standard VLANs, allow you to send traffic intended for a single destination MAC address to multiple switch ports. These high availability VLANs can be used to manage server clusters.","In This Chapter","This chapter describes the basic components of high availability VLANs and how to configure them through the Command Line Interface (CLI). CLI commands are used in the configuration examples; for more details about the syntax of commands, see the ","OmniSwitch AOS Release 8 CLI Reference Guide",".","Configuration procedures described in this chapter include:","•    ","Creating a VLAN on ","page 5-6",".","•    ","Adding and Removing Server Cluster Ports to a HA VLAN on ","page 5-7",".","•    ","Assigning and Modifying Server Cluster Mode on ","page 5-7",".","•    ","Assigning and Removing MAC addresses to a HA VLAN on ","page 5-8",".","High Availability Default Values","The table below lists default values for high availability VLAN software.","Parameter Description","Command","Default Value/Comments","Server cluster admin state of the server cluster","server-cluster","admin-state - enable","Server cluster id and mode","server-cluster","mode - L2","Mac address of the server cluster","server-cluster mac-address","None","IP address of the server cluster","server-cluster ip","IP address is configurable only for L3 clusters.","Configure the port/linkagg of a server cluster","server-cluster port","server-cluster linkagg","None","Quick Steps for Creating High Availability VLANs","Follow the steps below for a quick tutorial on configuring high availability (HA) VLANs. Additional information on how to configure each command is given in the sections that follow.","1    ","Create a server cluster that will become the HA VLAN by using the command ","server-cluster"," and configure the mode. For example:","-> server-cluster 1 name l2_cluster mode l2","2    ","Create a default VLAN for the HA VLAN ports with the ","vlan"," command as shown below:","-> vlan 10","3    ","Assign member ports to the new default VLAN with the ","vlan members untagged"," command as shown below:","-> vlan 10 members port 1/3 untagged","-> vlan 10 members port 1/4 untagged","-> vlan 10 members port 1/5 untagged","4    ","Assign mac-address for the new server cluster by using the command ","server-cluster mac-address",". For example:","-> server-cluster 1 vlan 10 port 1/3-5 mac-address 01:00:11:22:33:44","Note.  ","Optional",". You can display the configuration of high availability VLANs with the ","show server-cluster"," ","command. For example:","-> show server-cluster 1","Cluster Id : 1,","Cluster Name : L2-cluster,","Cluster Mode : L2,","Cluster Mac-address : 01:10:11:22:33:44,","Cluster Vlan : 12,","Administrative State: Enabled,","Operational State : Disabled,","Operational Flag : VPA is not forwarding","An example of what these commands look like entered sequentially on the command line:","-> server-cluster 1 mode L2","-> vlan 10","-> vlan 10 members port 1/3 untagged","-> vlan 10 members port 1/4 untagged","-> vlan 10 members port 1/5 untagged","-> server-cluster 1 vlan 10 port 1/3-5 mac-address 01:00:11:22:33:44 ","High Availability VLAN Overview","High availability (HA) VLANs send traffic intended for a single destination MAC address to multiple switch ports. An HA VLAN is configured by creating a standard VLAN and then assigning ports to the VLAN. Once these types of ports are assigned, the standard VLAN automatically becomes an HA VLAN. When this occurs, standard VLAN commands no longer apply.","Destination MAC addresses (unicast and multicast) are also assigned to high availability VLANs. These addresses identify ingress port traffic that the switch will send out on all egress ports that belong to the same VLAN","In addition to assigning ingress and egress ports, tagging inter-switch link ports with an HA VLAN ID is allowed. Ingress port traffic destined for an HA VLAN MAC address is sent out on all egress ","and"," inter-switch link ports that belong to the same VLAN. Traffic forwarded on inter-switch link ports is done so in accordance with the Spanning Tree state of the port.","A high availability VLAN hosts multiple instances of applications like e-commerce applications, critical databases, business applications etc and supports redundancy. Each instance may get all the service requests and based on a shared algorithm, HA VLAN decides on which requests a particular node has to handle. Apart from service request paths, the nodes are internally connected to share information related to the service load information, service request data and service availability on other nodes.","The HA VLAN feature on the OmniSwitch provides an elegant and flexible way to connect the server cluster nodes directly to the ingress network. This involves multicasting the service requests on the configured ports. The multicast criteria is configurable based on destination MAC and destination IP address. Egress ports can be statically configured on a server cluster or they can be registered by IGMP reports. The server cluster feature on the OmniSwitch multicast the incoming packets based on the server cluster configuration on the ports associated with the server cluster.","High Availability VLAN Operational Mode","There are typically two modes of implementation of server clusters in HA VLAN.","•    ","Layer 2 - The server cluster is attached to a L2 switch on which the frames destined to the cluster MAC address are to be flooded on all interfaces. For more information see ","“Example 1: Layer 2 Server Cluster” on page 5-9"," ","•    ","Layer 3 - The server cluster is attached to a L3 switch on which the frames destined to the server cluster IP address are to be routed to the server cluster IP and then flooded on all interfaces. For more information see ","“Example 2: Layer 3 Server Cluster” on page 5-11",".","Note.  ","The L2 mode is currently supported in AOS using the static mac-address command and L3 mode by the static ARP command.","Traffic Flows in High Availability VLAN","The figure below shows how ingress traffic is handled by high availability VLANs.","Figure 5-1 :  Example of an L2 Server Cluster - Ingress to Egress Port Flow","In the above example, packets received on the ingress ports that are destined for the high availability VLAN MAC address are sent out the egress ports that are members of the same VLAN. The MAC address is virtual to the server cluster, individual servers may have different physical MAC address.Since all three servers are connected to egress ports, they all receive the ingress port traffic. This provides a high level of availability in that if one of the server connections goes down, the other connections still forward traffic to one of the redundant servers.","Configuring High Availability VLANs on a Switch","This section describes how to use the Command Line Interface (CLI) commands to configure high availability (HA) VLANs on a switch. For a brief tutorial on configuring HA VLANs, see ","“Quick Steps for Creating High Availability VLANs” on page 5-3",".","When configuring HA VLANs, you must perform the following steps:","1    ","Create a VLAN",". To create a VLAN use the ","vlan"," command, which is described in ","“Creating and Deleting VLANs” on page 5-6",".","2    ","Assign VLAN member ports. ","To assign member ports to the VLAN, use the ","vlan members untagged"," command which is described in ","“Changing the Default VLAN Assignment for a Port” on page 4-6",".","3    ","Create a server cluster and configure the mode. ","To create a server cluster and configure the cluster mode, use the ","server-cluster"," command which is described in ","“Adding and Removing Server Cluster Ports” on page 5-7",".","4    ","Assign MAC Addresses",". To assign MAC addresses to the HA VLAN server cluster, use the ","server-cluster mac-address"," command, which is described in ","“Assigning and Removing MAC Addresses” on page 5-8",". ","Note.  ","Use the ","show server-cluster"," command to verify the HA VLAN configuration on the switch. See ","“Displaying High Availability VLAN Status” on page 5-16"," for more information.","Creating and Deleting VLANs","The following subsections describe how to create and delete a VLAN with the ","vlan"," command. ","Note.  ","This section provides only a basic description of creating and deleting VLANs. For a complete description of configuring and monitoring VLANs on a switch, please refer to ","Chapter 4, “Configuring VLANs.”","Creating a VLAN","To create a new VLAN use the ","vlan"," command by entering ","vlan"," followed by the VLAN ID number. For example, to create a VLAN with a VLAN ID number of 10 enter:","-> vlan 10","You can also specify the administrative status and a name for the VLAN with the ","vlan"," command. For example, to administratively enable (the default) a VLAN when you configure it enter ","vlan"," followed by the VLAN ID number and ","enable",".","For example, to create VLAN 10 and administratively enable it enter:","-> vlan 10 enable","Deleting a VLAN","To delete a VLAN use the ","no"," form of the ","vlan"," command by entering ","no vlan"," followed by the VLAN’s ID number. For example, to delete high availability VLAN 10 enter:","-> no vlan 10","Adding and Removing Server Cluster Ports","The following subsections describe how to assign to and remove ingress ports from a high availability VLAN with the ","server-cluster port"," command. ","Assigning Ports to a Server Cluster","To assign server cluster ports to a high availability VLAN use the ","server-cluster port/linkagg ","command. For example, to assign port 1/21 to server cluster “1”, enter the commands as:","-> server-cluster 1 port 1/21","To assign linkagg “1” to server cluster “3’, enter the commands as:","-> server-cluster 3 linkagg 1","Removing Ports from a Server Cluster","To remove server cluster ports from a high availability VLAN use the"," no ","form of ","server-cluster port/linkagg ","command. For example, ","-> no server-cluster 1 port 1/21","-> no server-cluster 3 linkagg 1","Assigning and Modifying Server Cluster Mode","The following subsections describe how to assign to and remove egress ports from a high availability VLAN with the ","server-cluster"," command.","Assigning L2 Mode to a Server Cluster","To assign L2 mode to a high availability VLAN use the ","server-cluster id ","command. For example, to assign “L2” mode to the server cluster “1”, enter the command as:","-> server-cluster 1 mode l2","If you want a name to be assigned along with the cluster mode, enter the commands as:","-> server-cluster 1 name l2_cluster mode l2","Assigning L3 Mode to a Server Cluster","A cluster can be assigned an IP address and an ARP entry mac-address. Each cluster should have a unique IP-address. IP address is configurable only for L3 clusters.","To assign L3 mode to a high availability VLAN use the ","server-cluster id ","command. For example, to assign “L3” mode to the server cluster “2”, enter the command as:","-> server-cluster 2 mode l3","-> server-cluster 5 port all","To assign L3 mode to linkaggs, enter the commands as:","-> server-cluster 3 linkagg 1","-> server-cluster 4 linkagg 1-3","To remove server cluster from a high availability VLAN, use the ","no"," form of the command. For example, ","-> no server-cluster 1","-> no server-cluster 2","Assigning and Removing MAC Addresses","The following subsections describe how to assign and remove MAC addresses from a high availability VLAN with the ","server-cluster mac-address"," command. Traffic that is received on ingress ports that contains a destination MAC address that matches the high availability VLAN address is sent out all egress ports that belong to the high availability VLAN. ","Note.  ","The multicast addresses within the following reserved ranges are not supported:","- 01:00:5E:00:00:00 to 01:00:5E:7F:FF:FF","- 01:80:C2:XX.XX.XX","- 33:33:XX:XX:XX:XX.","Assigning MAC Addresses","To assign a MAC address to a high availability VLAN, use the ","server-cluster mac-address ","command by entering ","server-cluster mac-address",", followed by the VLAN’s ID number, ","mac",", and the MAC address. Note that both unicast and multicast addresses are supported.","For example, to assign the MAC address 00:25:9a:5c:2f:10 to high availability VLAN 20, enter the command as:","-> server-cluster mac-address vlan 20 mac 00:25:9a:5c:2f:10","To add more than one MAC address to a high availability VLAN, enter each address on the same command line separated by a space. For example, to assign MAC addresses 00:25:9a:5c:2f:11, 00:25:9a:5c:12, and 01:00:00:3f:4c:10, to high availability VLAN 30, enter the command as:","-> server-cluster mac-address vlan 30 mac 00:25:9a:5c:2f:11 00:25:9a:5c:12 01:00:00:3f:4c:10.","Removing MAC Addresses","To remove a MAC address associated with a high availability VLAN, use the ","no"," form of the ","server-cluster mac-address ","command. For example, the following command removes MAC address 00:25:9a:5c:2f:10 from VLAN 20:","-> no server-cluster mac-address vlan 20 no mac 00:25:9a:5c:2f:10"," ","To remove more than one MAC address from a high availability VLAN using a single command, enter each address on the same command line separated by a space. For example, to remove MAC addresses 00:25:9a:5c:2f:11, 00:25:9a:5c:12, and 01:00:00:3f:4c:10, from high availability VLAN 30, enter the command as:","-> server-cluster mac-address vlan 30 no mac ","00:25:9a:5c:2f:11 00:25:9a:5c:12 01:00:00:3f:4c:10.","Note.  ","Removing the last MAC address from an HA VLAN is not allowed. Deleting the VLAN is required when there is only one MAC address left.","Application Examples","This section contains the following HAVLAN application examples:","•    ","“Example 1: Layer 2 Server Cluster” on page 5-9",".","•    ","“Example 2: Layer 3 Server Cluster” on page 5-11",".","•    ","“Example 3: Layer 3 Server Cluster with IP Multicast Address to Cluster (IGMP)” on page 5-13",".","Example 1: Layer 2 Server Cluster","In the following example, the MAC address can be unicast or L2 multicast or IP multicast.","Figure 5-2 :  Switch connected to an L2 Server Cluster through 3 ports (1/3, 1/4, 1/5)","•    ","A server cluster can be configured with a unique MAC address and a VLAN with a port list","•    ","The traffic which ingresses on 1/1 or 1/2 destined to the server cluster MAC address and the VLAN is forwarded to all the egress ports configured.(1/3,1/4,1/5).","•    ","Here the ingress ports must be in the same VLAN as the server cluster VLAN and egress ports and other traffic must be switched according to the normal switching logic.","Configuration Example","In this example, a packet can be an L2 or IP switched packet and Egress port can also be a linkagg port.","1    ","Create a server cluster that will become the HA VLAN by using the command ","server-cluster"," and configure the mode. For example:","-> server-cluster 1 mode l2 admin-state enable","2    ","Create a default VLAN for the HA VLAN ports with the ","vlan"," command as shown below:","-> vlan 10","3    ","Assign member ports to the new default VLAN with the ","vlan members untagged"," and ","server-cluster"," commands as shown below:","-> vlan 10 members port 1/3 untagged","-> vlan 10 members port 1/4 untagged","-> vlan 10 members port 1/5 untagged","-> server-cluster 1 port 1/3","-> server-cluster 1 port 1/4","-> server-cluster 1 port 1/5","4    ","Assign mac-address for the new server cluster by using the command ","server-cluster mac-address",". For example:","-> server-cluster 1 vlan 10 port mac-address 01:00:11:22:33:44","Note.  ","Optional",". You can display the configuration of high availability VLANs with the ","show server-cluster"," ","command. For example:","-> show server-cluster 1","Cluster Id : 1,","Cluster Name : L2-cluster,","Cluster Mode : L2,","Cluster Mac-address : 01:10:11:22:33:44,","Cluster Vlan : 12,","Administrative State: Enabled,","Operational State : Disabled,","Operational Flag : VPA is not forwarding","An example of what these commands look like entered sequentially on the command line:","-> server-cluster 1 mode L2 admin-state enable","-> vlan 10","-> vlan 10 members port 1/3 untagged","-> vlan 10 members port 1/4 untagged","-> vlan 10 members port 1/5 untagged","-> server-cluster 1 port 1/3","-> server-cluster 1 port 1/4","-> server-cluster 1 port 1/5","-> server-cluster 1 vlan 10 port 1/3-5 mac-address 01:00:11:22:33:44","Example 2: Layer 3 Server Cluster ","In this example, A server cluster is configured with a unique IP address and a static ARP entry (cluster MAC) and a port list. Here, the server cluster IP address must be a unicast address.","Figure 5-3 :  Switch connected to an L3 Server Cluster through 3 ports (1/3,1/4,1/5)","•    ","The traffic which ingresses on 1/1 or 1/2 destined to the server cluster IP is routed to all the egress ports configured (1/3,1/4,1/5). The ingress ports are on a different VLAN as the server cluster IP interface.","•    ","However, all the egress ports need to be in the same VLAN as the IP interface of server cluster. The other traffic must be switched according to the normal switching/routing logic.","•    ","Egress port can be a linkagg port as well.","Configuration Example","In this example, a packet is an L3 or IP switched packet.","1    ","Create a server cluster that will become the HA VLAN by using the command ","server-cluster"," and configure the mode. For example:","-> server-cluster 2 mode L3 admin-state enable","2    ","Create a default VLAN for the HA VLAN ports with the ","vlan"," command as shown below:","-> vlan 12","3    ","Assign member ports to the new default VLAN with the ","vlan members untagged"," and ","server-cluster"," commands as shown below:","-> vlan 12 members port 1/3 untagged","-> vlan 12 members port 1/4 untagged","-> vlan 12 members port 1/5 untagged","-> server-cluster 2 port 1/3","-> server-cluster 2 port 1/4","-> server-cluster 2 port 1/5","4    ","Assign an IP address for the by using the ","ip interface"," command. For example:","-> ip interface \"vlan 12\" ","-> ip interface \"vlan 12\" address 10.135.33.13/24 vlan 12","5    ","Assign mac-address for the new server cluster by using the command ","server-cluster mac-address",". For example:","-> server-cluster 2 ip 10.135.33.12 mac-address static 01:00:6e:22:33:44","Note.  ","Optional",". You can display the configuration of high availability VLANs with the ","show server-cluster"," ","command. For example:","-> show server-cluster 2","Cluster Id : 2,","Cluster Name : L3-cluster,","Cluster Mode : L3,","Cluster Mac-address : 01:10:11:22:33:44,","Cluster Vlan : 12,","Administrative State: Enabled,","Operational State : Enabled,","Operational Flag : -","An example of what these commands look like entered sequentially on the command line:","-> server-cluster 2 mode L3 admin-state enable","-> vlan 12","-> vlan 12 members port 1/3 tagged","-> vlan 12 members port 1/4 tagged","-> vlan 12 members port 1/5 tagged","-> server-cluster 2 port 1/3","-> server-cluster 2 port 1/4","-> server-cluster 2 port 1/5","-> ip interface \"vlan 12\"","-> ip interface \"vlan 12\" address 10.135.33.13/24 vlan 12","-> server-cluster 2 ip 10.135.33.12 mac-address static 01:00:6e:22:33:44","Example 3: Layer 3 Server Cluster with IP Multicast Address to Cluster (IGMP)","This example shows that a server cluster can be configured with a unique IP address and a IP multicast address. For this scenario, the server cluster IP address needs to be a unicast address and the MAC address (ARP entry) can be unicast or L2 multicast or IP multicast. The MAC address must be configured through CLI ARP resolution to a server cluster MAC, and must be configured before actual routing",".","Figure 5-4 :  Switch connected to an L3 Server Cluster (IGMP) through 3 ports (1/3,1/4,1/5)","•    ","There is no provision for port list configuration and Ports are derived dynamically using the IGMP snooping of the reports from the server cluster (IGMP v2 reports).","•    ","The traffic which ingresses on 1/1 or 1/2 destined to the server cluster IP is routed to all the ports which are members of the IP multicast group of the server cluster.","•    ","The ingress ports is on a different VLAN as the server cluster IP interface. Join and Leave messaged keep updating the egress port list. However all the egress ports need to be in the same VLAN as the IP interface of server cluster.","•    ","The other traffic is switched according to the normal switching/routing logic.","•    ","Egress port can be a linkagg port as well.","Note.  ","When a server cluster tries to send a bridged or routed packet to itself, a copy of the packet goes back to the sender’s (server cluster) port.","Configuration Example","In this example, a packet is an L3 IP switched packet and Egress port can also be a linkagg port.","1    ","Create a server cluster that will become the HA VLAN by using the command ","server-cluster"," and configure the mode. For example:","-> server-cluster 3 mode L3 admin-state enable","2    ","Create a default VLAN for the HA VLAN ports with the ","vlan"," command as shown below:","-> vlan 12","3    ","Assign member ports to the new default VLAN with the ","vlan members untagged"," and ","server-cluster"," commands as shown below:","-> vlan 12 members port 1/3 untagged","-> vlan 12 members port 1/4 untagged","-> vlan 12 members port 1/5 untagged","-> server-cluster 3 port 1/3","-> server-cluster 3 port 1/4","-> server-cluster 3 port 1/5","4    ","Assign mac-address for the new server cluster by using the command ","server-cluster mac-address",". For example:","-> server-cluster 3 ip 10.135.33.12 mac-address static 01:00:11:22:33:44 ","5    ","If you want to assign a dynamic mac-address for the server cluster, enter the command as follows:","-> server-cluster 3 ip 10.135.33.12 mac-address dynamic","6    ","Enable the admin state of the IP multicast by using the ","ip multicast admin-state enable"," command. IP multicast admin state should be enabled for the IGMP reports to be processed., else the cluster will be operationally down. ","-> ip multicast admin-state enable","-> server-cluster 3 igmp-mode enable","-> server-cluster 3 ip-multicast 225.0.0.23","When IGMP mode is enabled for the server cluster, all static ports will be reset in igmp mode.","Note.  ","Optional",". You can display the configuration of high availability VLANs with the ","show server-cluster"," ","command. For example:","-> show server-cluster 3","Cluster Id               : 3,","Cluster Name             : -,","Cluster Mode             : L3,","Cluster IP               : 10.135.33.12,","Cluster Mac-Address      : 01:00:11:22:33:44,","Cluster Mac Type         : Static,","IGMP-Mode                : Enabled,","Cluster Multicast IP     : 225.0.0.23,","Administrative State     : Enabled,","Operational State        : Disabled,","Operational Flag         : No IGMP members","An example of what these commands look like entered sequentially on the command line:","-> server-cluster 3 mode L3 admin-state enable","-> vlan 12","-> vlan 12 members port 1/3 untagged","-> vlan 12 members port 1/4 untagged","-> vlan 12 members port 1/5 untagged","-> server-cluster 3 port 1/3","-> server-cluster 3 port 1/4","-> server-cluster 3 port 1/5","-> server-cluster 3 ip 10.135.33.12 mac-address static 01:00:11:22:33:44 ","-> ip multicast admin-state enable ","-> server-cluster 3 igmp-mode enable","-> server-cluster 3 ip-multicast 225.0.0.23","Note.  ","In order to process IGMP reports, it is required to enable IP mulitcast by using the ","ip multicast admin-state enable"," command.","Displaying High Availability VLAN Status","You can use CLI ","show"," commands to display the current configuration and statistics of high availability VLANs on a switch. These commands include the following:","show server-cluster","Displays the server clusters configured in the system.","show vlan","Displays a list of all VLANs configured on the switch and the status of related VLAN properties (e.g., admin and Spanning Tree status and router port definitions).","show vlan members","Displays a list of VLAN port assignments. ","To display the status and configuration of high availability VLANs you use the ","show server-cluster"," command. To display the status and configuration of all high availability VLANs on a switch, enter the following command:","-> show server-cluster","A screen similar to the following will be displayed:","-> show server-cluster","Legend: * = not valid","Cluster       Mode    Vlan    Mac Address          Ip Address       IGMP Address          Name","---------+-----+-----+-------------------+---------------+-------------+-----------","* 10       L2    100    01:10:11:22:33:44              -          -       cluster1","  11       L2    100    01:10:11:22:33:44              -          -       cluster2","  12       L2    100    01:10:11:22:33:44          -                -       -","  13       L3    -    01:12:11:22:33:44    10.135.33.203                -       -","* 14       L3    -    01:12:11:22:33:45    10.135.33.203                -      -","  15       L3    -    01:00:6e:00:00:44    10.135.33.203             225.0.1.2          cluster-igmp","To display the status and configuration of a single high availability VLAN cluster enter ","show server-cluster"," followed by the server cluster ID number. For example, to display the status and configuration of high availability server cluster id “1”, enter the following command:","-> show server-cluster 1","A screen similar to the following will be displayed:","-> show server-cluster 1","Cluster Id : 1,","Cluster Name : L2-cluster,","Cluster Mode : L2,","Cluster Mac-address : 01:10:11:22:33:44,","Cluster Vlan : 12,","Administrative State: Enabled,","Operational State : Disabled,","Operational Flag : VPA is not forwarding","Note.  ","For more information on the CLI commands, See the ","OmniSwitch AOS Release 8 CLI Reference Guide","."]],"id":"7"})