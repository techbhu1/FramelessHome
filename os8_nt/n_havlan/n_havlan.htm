<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, user-scalable=yes"/>
  <meta name="version" content="2022.3.0"/>
  <link rel="StyleSheet" href="../../template/styles/topic.min.css" type="text/css"/>
  <link rel="StyleSheet" data-skin="true" type="text/css" href="../../template/Studio/layout.css"/>
  <link rel="StyleSheet" data-skin="true" href="../../template/Studio/userstyles.css" type="text/css"/>
  
  <script data-relpath="../.." src="../../template/scripts/csh-redirect.js" type="text/javascript"></script>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><title>n_havlan</title><link href="../css/rhstylemapping.css" rel="stylesheet" type="text/css"/><link href="../css/os8_nt.css" rel="stylesheet" type="text/css"/><link href="../css/editstyle.css" rel="stylesheet" type="text/css"/><meta name="rh-version" content="2022.3.93"/></head>

<body class="rh-BODY-wrapper">
  <div class="cookie-widget-holder" id="cookie-status-widget-holder"></div>
  <div class="RH-LAYOUT-HEADER-skip-content-container" id="skip-to-content"></div>
  <header class="RH-LAYOUT-HEADER-container" role="banner">
    <div class="RH-LAYOUT-HEADER-logo-box  ">
      <div class="RH-LAYOUT-HEADER-logo" id="logo-holder"></div>
      <div class="RH-LAYOUT-HEADER-title" id="topic-title-holder"></div>
    </div>
    <div class="RH-LAYOUT-HEADERMENU-container" id="header-menu"></div>
    <div class="search-placeholder-class" id="search-with-help"></div>
  </header>
  <main role="main" class="RH-LAYOUT-BODY-container">
    <div class="RH-LAYOUT-SEARCHRESULTS" id="rh-searchresults"></div>
    <div class="RH-LAYOUT-LEFTPANEL-container" id="rh-leftpanel"></div>
    <div class="rh-layout-BODY-main" id="rh-layout-main">
      <div class="RH-LAYOUT-TOOLBAR-toolbar-box" id="rh-toolbar"></div>
      <div class="rh-layout-BODY-body">
        <div class="RH-LAYOUT-CENTERPANEL-container">
          <div class="rh-layout-selectdetails" id="rh-selectdetails"></div>
          <div class="RH-LAYOUT-CENTERPANEL-topic-box" id="rh-topic" dir="ltr">

<div class="FLOW_A" dir="ltr"><p class="Chapter_Title" id="1060851">5    <br/><a id="XREF_53851__26_Configuring_High_Availability_VLANs20" name="XREF_53851__26_Configuring_High_Availability_VLANs20">Configuring High </a>Availability VLANs</p><p class="text" id="1065332"><a id="20_text_1065332" name="20_text_1065332"></a><a id="high_availability_VLANs" data-indexterm="high availability VLANs"></a><a id="VLANs:high_availability_VLANs" data-indexterm="VLANs:high availability VLANs"></a><a id="index_1065331" name="index_1065331"></a>High availability (HA) VLANs, unlike standard VLANs, allow you to send traffic intended for a single destination MAC address to multiple switch ports. These high availability VLANs can be used to manage server clusters.</p><p class="heading1" id="1037813">In This Chapter</p><p class="text" id="1081380">This chapter describes the basic components of high availability VLANs and how to configure them through the Command Line Interface (CLI). CLI commands are used in the configuration examples; for more details about the syntax of commands, see the <span class="Times_italics" data-keyref="CLI Reference Guide" style="font-family : Times New Roman ; font-weight:normal;font-style:Italic;font-size : 10.50pt;text-decoration:none;font-kerning:none;text-transform:none;font-stretch:normal;color:#000000;background-color:transparent;letter-spacing : 0.00em;">OmniSwitch AOS Release 8 CLI Reference Guide</span>.</p><p class="text" id="1081384">Configuration procedures described in this chapter include:</p><p class="bullet" id="1063937"><span class="Bullet_Character">•    </span>Creating a VLAN on <a href="#XREF_97979__Enabling_Server_Load_Balancing20" style="color:#0000ff;background-color:transparent;">page 5-6</a>.</p><p class="bullet" id="1063941"><span class="Bullet_Character">•    </span>Adding and Removing Server Cluster Ports to a HA VLAN on <a href="#XREF_27639__Assigning_Servers_to_a_Cluster20" style="color:#0000ff;background-color:transparent;">page 5-7</a>.</p><p class="bullet" id="1059718"><span class="Bullet_Character">•    </span>Assigning and Modifying Server Cluster Mode on <a href="#XREF_37369__Assigning_and_Removing_Egress_Ports20" style="color:#0000ff;background-color:transparent;">page 5-7</a>.</p><p class="bullet" id="1062004"><span class="Bullet_Character">•    </span>Assigning and Removing MAC addresses to a HA VLAN on <a href="#XREF_37863__Assigning_and_Removing_MAC_Addresses20" style="color:#0000ff;background-color:transparent;">page 5-8</a>.</p><p class="heading1" id="1036700"><a id="XREF_87393__Link_Aggregation_Specifications_Default_Values20" name="XREF_87393__Link_Aggregation_Specifications_Default_Values20">High Availability Default Values</a></p><p class="text" id="1036701"><a id="20_text_1036701" name="20_text_1036701"></a><a id="high_availability_VLANs:defaults" data-indexterm="high availability VLANs:defaults"></a><a id="defaults:high_availability_VLANs" data-indexterm="defaults:high availability VLANs"></a><a id="index_1043224" name="index_1043224"></a>The table below lists default values for high availability VLAN software.</p><div align="left"><table class="Defaults_Table"><colgroup><col width="216.00px"/><col width="192.00px"/><col width="192.00px"/></colgroup><thead><tr height="28.67px"><th><p class="CellHeading" id="1036734">Parameter Description</p></th><th><p class="CellHeading" id="1036736">Command</p></th><th><p class="CellHeading" id="1036738">Default Value/Comments</p></th></tr></thead><tbody><tr height="39.33px"><td><p class="CellBody" id="1036749">Server cluster admin state of the server cluster</p></td><td><p class="CellBody" id="1036754"><a href="../c_havlan/c_havlan.htm#XREF_94885__server-cluster_name" style="font-weight:Bold;color:#0000ff;background-color:transparent;">server-cluster</a></p></td><td><p class="CellBody" id="1075352">admin-state - enable</p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1079261">Server cluster id and mode</p></td><td><p class="CellBody" id="1079263"><a href="../c_havlan/c_havlan.htm#XREF_94885__server-cluster_name" style="font-weight:Bold;color:#0000ff;background-color:transparent;">server-cluster</a></p></td><td><p class="CellBody" id="1079265">mode - L2</p></td></tr><tr height="23.33px"><td><p class="CellBody" id="1036758">Mac address of the server cluster</p></td><td><p class="CellBody" id="1036763"><a href="../c_havlan/c_havlan.htm#XREF_23159__server-cluster_mac-address" style="font-weight:Bold;color:#0000ff;background-color:transparent;">server-cluster mac-address</a></p></td><td><p class="CellBody" id="1036765">None</p></td></tr><tr height="39.33px"><td><p class="CellBody" id="1062364">IP address of the server cluster</p></td><td><p class="CellBody" id="1062366"><a href="../c_havlan/c_havlan.htm#XREF_67127__server-cluster_IP" style="font-weight:Bold;color:#0000ff;background-color:transparent;">server-cluster ip</a></p></td><td><p class="CellBody" id="1062368">IP address is configurable only for L3 clusters.</p></td></tr><tr height="39.33px"><td><p class="CellBody" id="1063354">Configure the port/linkagg of a server cluster</p></td><td><p class="CellBody" id="1063356"><a href="../c_havlan/c_havlan.htm#XREF_10615__server-cluster_TBD" style="font-weight:Bold;color:#0000ff;background-color:transparent;">server-cluster port</a></p><p class="CellBody" id="1079290"><a href="../c_havlan/c_havlan.htm#XREF_96249__server-cluster_linkagg" style="font-weight:Bold;color:#0000ff;background-color:transparent;">server-cluster linkagg</a></p></td><td><p class="CellBody" id="1063358">None</p></td></tr></tbody></table></div><p></p><p class="heading1" id="1038811"><a id="XREF_74266__Quick_Steps_for_Configuring_Mandatory_SLB_Parameters20" name="XREF_74266__Quick_Steps_for_Configuring_Mandatory_SLB_Parameters20">Quick Steps for Creating High Availability VLANs</a></p><p class="text" id="1048009"><a id="20_text_1048009" name="20_text_1048009"></a><a id="high_availability_VLANs:application_examples" data-indexterm="high availability VLANs:application examples"></a><a id="application_examples:high_availability_VLANs" data-indexterm="application examples:high availability VLANs"></a><a id="index_1048008" name="index_1048008"></a>Follow the steps below for a quick tutorial on configuring high availability (HA) VLANs. Additional information on how to configure each command is given in the sections that follow.</p><p class="step_first" id="1072128"><span class="Futura_Bold">1    </span>Create a server cluster that will become the HA VLAN by using the command <a href="../c_havlan/c_havlan.htm#XREF_94885__server-cluster_name" style="font-weight:Bold;color:#0000ff;background-color:transparent;">server-cluster</a> and configure the mode. For example:</p><p class="example1" id="1048010">-&gt; server-cluster 1 name l2_cluster mode l2</p><p class="step_next" id="1072120"><span class="Futura_Bold">2    </span>Create a default VLAN for the HA VLAN ports with the <a href="../c_vlans/c_vlans.htm#XREF_44597__vlan" style="font-weight:Bold;color:#0000ff;background-color:transparent;">vlan</a> command as shown below:</p><p class="example1" id="1048011">-&gt; vlan 10</p><p class="step_next" id="1050571"><span class="Futura_Bold">3    </span>Assign member ports to the new default VLAN with the <a href="../c_vlans/c_vlans.htm#XREF_27358__vlan_stp" style="font-weight:Bold;color:#0000ff;background-color:transparent;">vlan members untagged</a> command as shown below:</p><p class="example1" id="1065512">-&gt; vlan 10 members port 1/3 untagged</p><p class="example2" id="1081609">-&gt; vlan 10 members port 1/4 untagged</p><p class="example2" id="1081612">-&gt; vlan 10 members port 1/5 untagged</p><p class="step_next" id="1072042"><span class="Futura_Bold">4    </span>Assign mac-address for the new server cluster by using the command <a href="../c_havlan/c_havlan.htm#XREF_23159__server-cluster_mac-address" style="font-weight:Bold;color:#0000ff;background-color:transparent;">server-cluster mac-address</a>. For example:</p><p class="example1" id="1072076">-&gt; server-cluster 1 vlan 10 port 1/3-5 mac-address 01:00:11:22:33:44</p><p></p><div align="left"><table class="Note"><colgroup><col width="600.00px"/></colgroup><tbody><tr height="202.67px"><td><p class="CellBody_note_text" id="1081618"><span class="Bold">Note.  </span><span class="Times_italics" style="font-style:Italic;font-kerning:none;background-color:transparent;">Optional</span>. You can display the configuration of high availability VLANs with the <a href="../c_havlan/c_havlan.htm#XREF_83055__show_server-cluster" style="font-weight:Bold;font-kerning:none;color:#0000ff;background-color:transparent;">show server-cluster</a><span class="Times_Bold" style="font-weight:Bold;font-kerning:none;background-color:transparent;"> </span>command. For example:</p><p class="screen2" id="1081640"><br/></p><p class="screen" id="1082220">-&gt; show server-cluster 1</p><p class="screen2" id="1082221">Cluster Id : 1,</p><p class="screen2" id="1082222">Cluster Name : L2-cluster,</p><p class="screen2" id="1081653">Cluster Mode : L2,</p><p class="screen2" id="1081654">Cluster Mac-address : 01:10:11:22:33:44,</p><p class="screen2" id="1082233">Cluster Vlan : 12,</p><p class="screen2" id="1082234">Administrative State: Enabled,</p><p class="screen2" id="1082235">Operational State : Disabled,</p><p class="screen2" id="1081658">Operational Flag : VPA is not forwarding</p></td></tr></tbody></table></div><p></p><p class="text" id="1065610">An example of what these commands look like entered sequentially on the command line:</p><p class="example1" id="1072098">-&gt; server-cluster 1 mode L2</p><p class="example2" id="1081682">-&gt; vlan 10</p><p class="example2" id="1081685">-&gt; vlan 10 members port 1/3 untagged</p><p class="example2" id="1081688">-&gt; vlan 10 members port 1/4 untagged</p><p class="example2" id="1081691">-&gt; vlan 10 members port 1/5 untagged</p><p class="example2" id="1081694">-&gt; server-cluster 1 vlan 10 port 1/3-5 mac-address 01:00:11:22:33:44 </p><p class="heading1" id="1071840"><a id="XREF_11771__command_example20" name="XREF_11771__command_example20">High Availability VLAN Overview</a></p><p class="text" id="1074159"><a id="20_text_1074159" name="20_text_1074159"></a>High availability (HA) VLANs send traffic intended for a single destination MAC address to multiple switch ports. An HA VLAN is configured by creating a standard VLAN and then assigning ports to the VLAN. Once these types of ports are assigned, the standard VLAN automatically becomes an HA VLAN. When this occurs, standard VLAN commands no longer apply.</p><p class="text" id="1074161">Destination MAC addresses (unicast and multicast) are also assigned to high availability VLANs. These addresses identify ingress port traffic that the switch will send out on all egress ports that belong to the same VLAN</p><p class="text" id="1069434">In addition to assigning ingress and egress ports, tagging inter-switch link ports with an HA VLAN ID is allowed. Ingress port traffic destined for an HA VLAN MAC address is sent out on all egress <span class="Times_italics" style="font-style:Italic;background-color:transparent;">and</span> inter-switch link ports that belong to the same VLAN. Traffic forwarded on inter-switch link ports is done so in accordance with the Spanning Tree state of the port.</p><p class="text" id="1074157">A high availability VLAN hosts multiple instances of applications like e-commerce applications, critical databases, business applications etc and supports redundancy. Each instance may get all the service requests and based on a shared algorithm, HA VLAN decides on which requests a particular node has to handle. Apart from service request paths, the nodes are internally connected to share information related to the service load information, service request data and service availability on other nodes.</p><p class="text" id="1069412">The HA VLAN feature on the OmniSwitch provides an elegant and flexible way to connect the server cluster nodes directly to the ingress network. This involves multicasting the service requests on the configured ports. The multicast criteria is configurable based on destination MAC and destination IP address. Egress ports can be statically configured on a server cluster or they can be registered by IGMP reports. The server cluster feature on the OmniSwitch multicast the incoming packets based on the server cluster configuration on the ports associated with the server cluster.</p><p class="heading2" id="1075070">High Availability VLAN Operational Mode</p><p class="text" id="1069446">There are typically two modes of implementation of server clusters in HA VLAN.</p><p class="bullet" id="1070303"><span class="Bullet_Character">•    </span>Layer 2 - The server cluster is attached to a L2 switch on which the frames destined to the cluster MAC address are to be flooded on all interfaces. For more information see <a href="#XREF_26684__Layer_2_Server_Cluster20" style="color:#0000ff;background-color:transparent;">“Example 1: Layer 2 Server Cluster” on page 5-9</a><span class="blue_bold" style="font-weight:Bold;color:#0000ff;background-color:transparent;"> </span></p><p class="bullet" id="1075063"><span class="Bullet_Character">•    </span>Layer 3 - The server cluster is attached to a L3 switch on which the frames destined to the server cluster IP address are to be routed to the server cluster IP and then flooded on all interfaces. For more information see <a href="#XREF_71716__Layer_3_Server_Cluster20" style="color:#0000ff;background-color:transparent;">“Example 2: Layer 3 Server Cluster” on page 5-11</a>.</p><p></p><div align="left"><table class="Note"><colgroup><col width="600.00px"/></colgroup><tbody><tr height="38.00px"><td><p class="CellBody_note_text" id="1081706"><span class="Bold">Note.  </span>The L2 mode is currently supported in AOS using the static mac-address command and L3 mode by the static ARP command.</p></td></tr></tbody></table></div><p></p><p class="heading2" id="1074089"><a id="XREF_87828__Layer_2_Cluster_Scenario20" name="XREF_87828__Layer_2_Cluster_Scenario20"></a><a id="XREF_74199__Ingress_and_Egress_Traffic_Flows20" name="XREF_74199__Ingress_and_Egress_Traffic_Flows20">Traffic Flows in High Availability VLAN</a></p><p class="text" id="1073604"><a id="20_text_1073604" name="20_text_1073604"></a><a id="high_availability_VLANs:traffic_flow" data-indexterm="high availability VLANs:traffic flow"></a><a id="index_1072716" name="index_1072716"></a>The figure below shows how ingress traffic is handled by high availability VLANs.</p><p class="text" id="1074234"><object class="imageSettings" data="../images/os8_nt_n_havlan_FOM_SVG_24.svg" height="376.000631" style="display:block;align:left;" type="image/svg+xml" width="624.000000"></object></p><p class="Figure_Title_NumOne" id="1050971">Figure 5-1 :  Example of an L2 Server Cluster - Ingress to Egress Port Flow</p><p class="text" id="1062941">In the above example, packets received on the ingress ports that are destined for the high availability VLAN MAC address are sent out the egress ports that are members of the same VLAN. The MAC address is virtual to the server cluster, individual servers may have different physical MAC address.Since all three servers are connected to egress ports, they all receive the ingress port traffic. This provides a high level of availability in that if one of the server connections goes down, the other connections still forward traffic to one of the redundant servers.</p><p class="heading1" id="1035792"><a id="XREF_62980__Server_Load_Balancing_Application_Example20" name="XREF_62980__Server_Load_Balancing_Application_Example20"></a><a id="XREF_18489__Configuring_Server_Load_Balancing_on_a_Switch20" name="XREF_18489__Configuring_Server_Load_Balancing_on_a_Switch20">Configuring High Availability VLANs on a Switch</a></p><p class="text" id="1063224"><a id="20_text_1063224" name="20_text_1063224"></a><a id="high_availability_VLANs:configuration_steps" data-indexterm="high availability VLANs:configuration steps"></a><a id="index_1063220" name="index_1063220"></a>This section describes how to use the Command Line Interface (CLI) commands to configure high availability (HA) VLANs on a switch. For a brief tutorial on configuring HA VLANs, see <a href="#XREF_74266__Quick_Steps_for_Configuring_Mandatory_SLB_Parameters20" style="color:#0000ff;background-color:transparent;">“Quick Steps for Creating High Availability VLANs” on page 5-3</a>.</p><p class="text" id="1063238">When configuring HA VLANs, you must perform the following steps:</p><p class="step_first" id="1072372"><span class="Futura_Bold">1    </span><span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">Create a VLAN</span>. To create a VLAN use the <a href="../c_vlans/c_vlans.htm#XREF_44597__vlan" style="font-weight:Bold;color:#0000ff;background-color:transparent;">vlan</a> command, which is described in <a href="#XREF_97979__Enabling_Server_Load_Balancing20" style="color:#0000ff;background-color:transparent;">“Creating and Deleting VLANs” on page 5-6</a>.</p><p class="step_next" id="1072381"><span class="Futura_Bold">2    </span><span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">Assign VLAN member ports. </span>To assign member ports to the VLAN, use the <a href="../c_vlans/c_vlans.htm#XREF_27358__vlan_stp" style="font-weight:Bold;color:#0000ff;background-color:transparent;">vlan members untagged</a> command which is described in <a href="../n_vlans/n_vlans.htm#XREF_53400__Changing_the_Default_VLAN_Assignment_for_a_Port18" style="color:#0000ff;background-color:transparent;">“Changing the Default VLAN Assignment for a Port” on page 4-6</a>.</p><p class="step_next" id="1077858" style="font-weight:Bold;"><span class="Futura_Bold">3    </span><span class="Times_Bold" style="background-color:transparent;">Create a server cluster and configure the mode. </span><span style="font-weight:normal;">To create a server cluster and configure the cluster mode, use the <a href="../c_havlan/c_havlan.htm#XREF_94885__server-cluster_name" style="color:#0000ff;background-color:transparent;">server-cluster</a></span><span style="font-weight:normal;"> command which is described in <a href="#XREF_27639__Assigning_Servers_to_a_Cluster20" style="font-weight:normal;color:#0000ff;background-color:transparent;">“Adding and Removing Server Cluster Ports” on page 5-7</a></span><span style="font-weight:normal;">.</span></p><p class="step_next" id="1077864"><span class="Futura_Bold">4    </span><span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">Assign MAC Addresses</span>. To assign MAC addresses to the HA VLAN server cluster, use the <a href="../c_havlan/c_havlan.htm#XREF_23159__server-cluster_mac-address" style="font-weight:Bold;color:#0000ff;background-color:transparent;">server-cluster mac-address</a> command, which is described in <a href="#XREF_37863__Assigning_and_Removing_MAC_Addresses20" style="color:#0000ff;background-color:transparent;">“Assigning and Removing MAC Addresses” on page 5-8</a>. </p><p></p><div align="left"><table class="Note"><colgroup><col width="600.00px"/></colgroup><tbody><tr height="38.00px"><td><p class="CellBody_note_text" id="1081742"><span class="Bold">Note.  </span>Use the <a href="../c_havlan/c_havlan.htm#XREF_83055__show_server-cluster" style="font-weight:Bold;font-kerning:none;color:#0000ff;background-color:transparent;">show server-cluster</a> command to verify the HA VLAN configuration on the switch. See <a href="#XREF_97220__Using_Show_Commands20" style="font-kerning:none;color:#0000ff;background-color:transparent;">“Displaying High Availability VLAN Status” on page 5-16</a> for more information.</p></td></tr></tbody></table></div><p></p><p class="heading2" id="1063528"><a id="XREF_97979__Enabling_Server_Load_Balancing20" name="XREF_97979__Enabling_Server_Load_Balancing20">Creating and Deleting VLANs</a></p><p class="text" id="1009659"><a id="20_text_1009659" name="20_text_1009659"></a>The following subsections describe how to create and delete a VLAN with the <a id="{index}vlan{Default_Para_Font}_command" data-indexterm="{index}vlan{Default Para Font} command"></a><a id="index_1061464" name="index_1061464"></a><a href="../c_vlans/c_vlans.htm#XREF_44597__vlan" style="font-weight:Bold;color:#0000ff;background-color:transparent;">vlan</a> command. </p><p></p><div align="left"><table class="Note"><colgroup><col width="600.00px"/></colgroup><tbody><tr height="54.00px"><td><p class="CellBody_note_text" id="1081771"><span class="Bold">Note.  </span>This section provides only a basic description of creating and deleting VLANs. For a complete description of configuring and monitoring VLANs on a switch, please refer to <a href="../n_vlans/n_vlans.htm#XREF_68835__1_Configuring_VLANs18" style="font-kerning:none;color:#0000ff;background-color:transparent;">Chapter 4, “Configuring VLANs.”</a></p></td></tr></tbody></table></div><p></p><p class="heading3" id="1063189">Creating a VLAN</p><p class="text" id="1039215"><a id="high_availability_VLANs:creating_high_availability_VLANs" data-indexterm="high availability VLANs:creating high availability VLANs"></a><a id="index_1061439" name="index_1061439"></a>To create a new VLAN use the <a href="../c_vlans/c_vlans.htm#XREF_44597__vlan" style="font-weight:Bold;color:#0000ff;background-color:transparent;">vlan</a> command by entering <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">vlan</span> followed by the VLAN ID number. For example, to create a VLAN with a VLAN ID number of 10 enter:</p><p class="example1" id="1039237">-&gt; vlan 10</p><p class="text" id="1057628">You can also specify the administrative status and a name for the VLAN with the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">vlan</span> command. For example, to administratively enable (the default) a VLAN when you configure it enter <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">vlan</span> followed by the VLAN ID number and <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">enable</span>.</p><p class="text" id="1057637">For example, to create VLAN 10 and administratively enable it enter:</p><p class="example1" id="1057641">-&gt; vlan 10 enable</p><p class="heading3" id="1078291">Deleting a VLAN</p><p class="text" id="1039248"><a id="high_availability_VLANs:deleting_high_availability_VLANs" data-indexterm="high availability VLANs:deleting high availability VLANs"></a><a id="index_1061433" name="index_1061433"></a>To delete a VLAN use the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">no</span> form of the <a href="../c_vlans/c_vlans.htm#XREF_44597__vlan" style="font-weight:Bold;color:#0000ff;background-color:transparent;">vlan</a> command by entering <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">no vlan</span> followed by the VLAN’s ID number. For example, to delete high availability VLAN 10 enter:</p><p class="example1" id="1009677">-&gt; no vlan 10</p><p class="heading2" id="1075124"><a id="XREF_27639__Assigning_Servers_to_a_Cluster20" name="XREF_27639__Assigning_Servers_to_a_Cluster20">Adding and Removing Server Cluster Ports</a></p><p class="text" id="1075125"><a id="20_text_1075125" name="20_text_1075125"></a>The following subsections describe how to assign to and remove ingress ports from a high availability VLAN with the <a id="{index}vlan_port-mac_ingress-port{Default_Para_Font}_command" data-indexterm="{index}vlan port-mac ingress-port{Default Para Font} command"></a><a id="index_1075126" name="index_1075126"></a><a href="../c_havlan/c_havlan.htm#XREF_10615__server-cluster_TBD" style="font-weight:Bold;color:#0000ff;background-color:transparent;">server-cluster port</a> command. </p><p class="heading3" id="1074629">Assigning Ports to a Server Cluster</p><p class="text" id="1074631"><a id="high_availability_VLANs:adding_ingress_ports" data-indexterm="high availability VLANs:adding ingress ports"></a><a id="index_1074630" name="index_1074630"></a>To assign server cluster ports to a high availability VLAN use the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">server-cluster port/linkagg </span>command. For example, to assign port 1/21 to server cluster “1”, enter the commands as:</p><p class="example1" id="1074635">-&gt; server-cluster 1 port 1/21</p><p class="text" id="1075085">To assign linkagg “1” to server cluster “3’, enter the commands as:</p><p class="example1" id="1075086">-&gt; server-cluster 3 linkagg 1</p><p class="heading3" id="1074632">Removing Ports from a Server Cluster</p><p class="text" id="1058032">To remove server cluster ports from a high availability VLAN use the<span class="Bold"> no </span>form of <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">server-cluster port/linkagg </span>command. For example, </p><p class="example1" id="1075107">-&gt; no server-cluster 1 port 1/21</p><p class="example2" id="1081852">-&gt; no server-cluster 3 linkagg 1</p><p class="heading2" id="1057443"><a id="XREF_37369__Assigning_and_Removing_Egress_Ports20" name="XREF_37369__Assigning_and_Removing_Egress_Ports20">Assigning and Modifying Server Cluster Mode</a></p><p class="text" id="1058156"><a id="20_text_1058156" name="20_text_1058156"></a>The following subsections describe how to assign to and remove egress ports from a high availability VLAN with the <a id="{index}vlan_port-mac_egress-port{Default_Para_Font}_command" data-indexterm="{index}vlan port-mac egress-port{Default Para Font} command"></a><a id="index_1061489" name="index_1061489"></a><a href="../c_havlan/c_havlan.htm#XREF_94885__server-cluster_name" style="font-weight:Bold;color:#0000ff;background-color:transparent;">server-cluster</a> command.</p><p class="heading3" id="1062128">Assigning L2 Mode to a Server Cluster</p><p class="text" id="1074667"><a id="high_availability_VLANs:adding_egress_ports" data-indexterm="high availability VLANs:adding egress ports"></a><a id="index_1074666" name="index_1074666"></a>To assign L2 mode to a high availability VLAN use the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">server-cluster id </span>command. For example, to assign “L2” mode to the server cluster “1”, enter the command as:</p><p class="example1" id="1075146">-&gt; server-cluster 1 mode l2</p><p class="text" id="1075167">If you want a name to be assigned along with the cluster mode, enter the commands as:</p><p class="example1" id="1075171">-&gt; server-cluster 1 name l2_cluster mode l2</p><p class="heading3" id="1074692">Assigning L3 Mode to a Server Cluster</p><p class="text" id="1074694"><a id="high_availability_VLANs:deleting_egress_ports" data-indexterm="high availability VLANs:deleting egress ports"></a><a id="index_1074693" name="index_1074693"></a>A cluster can be assigned an IP address and an ARP entry mac-address. Each cluster should have a unique IP-address. IP address is configurable only for L3 clusters.</p><p class="text" id="1075197"><a id="high_availability_VLANs:adding_egress_ports1" data-indexterm="high availability VLANs:adding egress ports"></a><a id="index_1075196" name="index_1075196"></a>To assign L3 mode to a high availability VLAN use the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">server-cluster id </span>command. For example, to assign “L3” mode to the server cluster “2”, enter the command as:</p><p class="example1" id="1075194">-&gt; server-cluster 2 mode l3</p><p class="example2" id="1081855">-&gt; server-cluster 5 port all</p><p class="text" id="1075219">To assign L3 mode to linkaggs, enter the commands as:</p><p class="example1" id="1075222">-&gt; server-cluster 3 linkagg 1</p><p class="example2" id="1081858">-&gt; server-cluster 4 linkagg 1-3</p><p class="text" id="1075318">To remove server cluster from a high availability VLAN, use the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">no</span> form of the command. For example, </p><p class="example1" id="1074719">-&gt; no server-cluster 1</p><p class="example2" id="1081864">-&gt; no server-cluster 2</p><p class="heading2" id="1074708"><a id="XREF_37863__Assigning_and_Removing_MAC_Addresses20" name="XREF_37863__Assigning_and_Removing_MAC_Addresses20">Assigning and Removing MAC Addresses</a></p><p class="text" id="1062114"><a id="20_text_1062114" name="20_text_1062114"></a>The following subsections describe how to assign and remove MAC addresses from a high availability VLAN with the <a id="{index}vlan_port-mac_egress-port{Default_Para_Font}_command1" data-indexterm="{index}vlan port-mac egress-port{Default Para Font} command"></a><a id="index_1062115" name="index_1062115"></a><a href="../c_havlan/c_havlan.htm#XREF_23159__server-cluster_mac-address" style="font-weight:Bold;color:#0000ff;background-color:transparent;">server-cluster mac-address</a> command. Traffic that is received on ingress ports that contains a destination MAC address that matches the high availability VLAN address is sent out all egress ports that belong to the high availability VLAN. <span style="font-size : 12.00pt;"></span></p><div align="left"><table class="Note"><colgroup><col width="600.00px"/></colgroup><tbody><tr height="70.00px"><td><p class="CellBody_note_text" id="1084617"><span class="Bold">Note.  </span>The multicast addresses within the following reserved ranges are not supported:<br/>- 01:00:5E:00:00:00 to 01:00:5E:7F:FF:FF<br/>- 01:80:C2:XX.XX.XX<br/>- 33:33:XX:XX:XX:XX.</p></td></tr></tbody></table></div><p></p><p class="heading3" id="1062155">Assigning MAC Addresses</p><p class="text" id="1062157"><a id="high_availability_VLANs:adding_egress_ports2" data-indexterm="high availability VLANs:adding egress ports"></a><a id="index_1062156" name="index_1062156"></a>To assign a MAC address to a high availability VLAN, use the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">server-cluster mac-address </span>command by entering <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">server-cluster mac-address</span>, followed by the VLAN’s ID number, <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">mac</span>, and the MAC address. Note that both unicast and multicast addresses are supported.</p><p class="text" id="1062158">For example, to assign the MAC address 00:25:9a:5c:2f:10 to high availability VLAN 20, enter the command as:</p><p class="example1" id="1062159">-&gt; server-cluster mac-address vlan 20 mac 00:25:9a:5c:2f:10</p><p class="text" id="1062195">To add more than one MAC address to a high availability VLAN, enter each address on the same command line separated by a space. For example, to assign MAC addresses 00:25:9a:5c:2f:11, 00:25:9a:5c:12, and 01:00:00:3f:4c:10, to high availability VLAN 30, enter the command as:</p><p class="example1" id="1062220">-&gt; server-cluster mac-address vlan 30 mac 00:25:9a:5c:2f:11 00:25:9a:5c:12 01:00:00:3f:4c:10.</p><p class="heading3" id="1062112">Removing MAC Addresses</p><p class="text" id="1062236">To remove a MAC address associated with a high availability VLAN, use the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">no</span> form of the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">server-cluster mac-address </span>command. For example, the following command removes MAC address 00:25:9a:5c:2f:10 from VLAN 20:</p><p class="example1" id="1062248">-&gt; no server-cluster mac-address vlan 20 no mac 00:25:9a:5c:2f:10<span style="font-family : Times New Roman ; font-size : 10.50pt;"> </span></p><p class="text" id="1062261">To remove more than one MAC address from a high availability VLAN using a single command, enter each address on the same command line separated by a space. For example, to remove MAC addresses 00:25:9a:5c:2f:11, 00:25:9a:5c:12, and 01:00:00:3f:4c:10, from high availability VLAN 30, enter the command as:</p><p class="example1" id="1062262">-&gt; server-cluster mac-address vlan 30 no mac <span style="font-family : Times New Roman ; font-size : 10.50pt;">00:25:9a:5c:2f:11 00:25:9a:5c:12 01:00:00:3f:4c:10.</span></p><p></p><div align="left"><table class="Note"><colgroup><col width="600.00px"/></colgroup><tbody><tr height="38.00px"><td><p class="CellBody_note_text" id="1081943"><span class="Bold">Note.  </span>Removing the last MAC address from an HA VLAN is not allowed. Deleting the VLAN is required when there is only one MAC address left.</p></td></tr></tbody></table></div><p></p><p class="heading1" id="1074109">Application Examples</p><p class="text" id="1079794">This section contains the following HAVLAN application examples:</p><p class="bullet" id="1079796"><span class="Bullet_Character">•    </span><a href="#XREF_26684__Layer_2_Server_Cluster20" style="color:#0000ff;background-color:transparent;">“Example 1: Layer 2 Server Cluster” on page 5-9</a>.</p><p class="bullet" id="1079829"><span class="Bullet_Character">•    </span><a href="#XREF_71716__Layer_3_Server_Cluster20" style="color:#0000ff;background-color:transparent;">“Example 2: Layer 3 Server Cluster” on page 5-11</a>.</p><p class="bullet" id="1079835"><span class="Bullet_Character">•    </span><a href="#XREF_74305__Layer_3_Server_Cluster_%13_IP_Multicast_Address_to20" style="color:#0000ff;background-color:transparent;">“Example 3: Layer 3 Server Cluster with IP Multicast Address to Cluster (IGMP)” on page 5-13</a>.</p><p class="heading2" id="1079788"><a id="XREF_26684__Layer_2_Server_Cluster20" name="XREF_26684__Layer_2_Server_Cluster20">Example 1: Layer 2 Server Cluster</a></p><p class="text" id="1073779"><a id="20_text_1073779" name="20_text_1073779"></a>In the following example, the MAC address can be unicast or L2 multicast or IP multicast.</p><p class="text" id="1073783"><object class="imageSettings" data="../images/HAVLAN-1_FOM_SVG_26.svg" height="358.000631" style="display:block;align:left;" type="image/svg+xml" width="623.039998"></object></p><p class="FigureTitle" id="1073784">Figure 5-2 :  Switch connected to an L2 Server Cluster through 3 ports (1/3, 1/4, 1/5)</p><p class="bullet" id="1073785"><span class="Bullet_Character">•    </span>A server cluster can be configured with a unique MAC address and a VLAN with a port list</p><p class="bullet" id="1073786"><span class="Bullet_Character">•    </span>The traffic which ingresses on 1/1 or 1/2 destined to the server cluster MAC address and the VLAN is forwarded to all the egress ports configured.(1/3,1/4,1/5).</p><p class="bullet" id="1073787"><span class="Bullet_Character">•    </span>Here the ingress ports must be in the same VLAN as the server cluster VLAN and egress ports and other traffic must be switched according to the normal switching logic.</p><p class="heading3" id="1074352"><span class="Bold" style="font-family : Futura Book ; font-style:normal;font-size : 12.00pt;text-decoration:none;font-kerning:normal;text-transform:none;font-stretch:normal;color:#000000;background-color:transparent;letter-spacing : 0.00em;">Configuration Example</span></p><p class="text" id="1079955">In this example, a packet can be an L2 or IP switched packet and Egress port can also be a linkagg port.</p><p class="step_first" id="1074360"><span class="Futura_Bold">1    </span>Create a server cluster that will become the HA VLAN by using the command <a href="../c_havlan/c_havlan.htm#XREF_94885__server-cluster_name" style="font-weight:Bold;color:#0000ff;background-color:transparent;">server-cluster</a> and configure the mode. For example:</p><p class="example1" id="1074258">-&gt; server-cluster 1 mode l2 admin-state enable</p><p class="step_next" id="1074262"><span class="Futura_Bold">2    </span>Create a default VLAN for the HA VLAN ports with the <a href="../c_vlans/c_vlans.htm#XREF_44597__vlan" style="font-weight:Bold;color:#0000ff;background-color:transparent;">vlan</a> command as shown below:</p><p class="example1" id="1074263">-&gt; vlan 10</p><p class="step_next" id="1074267"><span class="Futura_Bold">3    </span>Assign member ports to the new default VLAN with the <a href="../c_vlans/c_vlans.htm#XREF_27358__vlan_stp" style="font-weight:Bold;color:#0000ff;background-color:transparent;">vlan members untagged</a> and <a href="../c_havlan/c_havlan.htm#XREF_94885__server-cluster_name" style="font-weight:Bold;color:#0000ff;background-color:transparent;">server-cluster</a> commands as shown below:</p><p class="example1" id="1074268">-&gt; vlan 10 members port 1/3 untagged</p><p class="example2" id="1081992">-&gt; vlan 10 members port 1/4 untagged</p><p class="example2" id="1081995">-&gt; vlan 10 members port 1/5 untagged</p><p class="example2" id="1082821">-&gt; server-cluster 1 port 1/3</p><p class="example2" id="1082849">-&gt; server-cluster 1 port 1/4</p><p class="example2" id="1082877">-&gt; server-cluster 1 port 1/5</p><p class="step_next" id="1074272"><span class="Futura_Bold">4    </span>Assign mac-address for the new server cluster by using the command <a href="../c_havlan/c_havlan.htm#XREF_23159__server-cluster_mac-address" style="font-weight:Bold;color:#0000ff;background-color:transparent;">server-cluster mac-address</a>. For example:</p><p class="example1" id="1074345">-&gt; server-cluster 1 vlan 10 port mac-address 01:00:11:22:33:44</p><p></p><div align="left"><table class="Note"><colgroup><col width="600.00px"/></colgroup><tbody><tr height="198.67px"><td><p class="CellBody_note_text" id="1082001"><span class="Bold">Note.  </span><span class="Times_italics" style="font-style:Italic;font-kerning:none;background-color:transparent;">Optional</span>. You can display the configuration of high availability VLANs with the <a href="../c_havlan/c_havlan.htm#XREF_83055__show_server-cluster" style="font-weight:Bold;font-kerning:none;color:#0000ff;background-color:transparent;">show server-cluster</a><span class="Times_Bold" style="font-weight:Bold;font-kerning:none;background-color:transparent;"> </span>command. For example:</p><p class="screen2" id="1082031"><br/></p><p class="screen2" id="1082055">-&gt; show server-cluster 1</p><p class="screen2" id="1082032">Cluster Id : 1,</p><p class="screen2" id="1082033">Cluster Name : L2-cluster,</p><p class="screen2" id="1082034">Cluster Mode : L2,</p><p class="screen2" id="1082035">Cluster Mac-address : 01:10:11:22:33:44,</p><p class="screen2" id="1082036">Cluster Vlan : 12,</p><p class="screen2" id="1082037">Administrative State: Enabled,</p><p class="screen2" id="1082038">Operational State : Disabled,</p><p class="screen2" id="1082039">Operational Flag : VPA is not forwarding</p></td></tr></tbody></table></div><p></p><p class="text" id="1074333">An example of what these commands look like entered sequentially on the command line:</p><p class="example1" id="1074300">-&gt; server-cluster 1 mode L2 admin-state enable</p><p class="example2" id="1082063">-&gt; vlan 10</p><p class="example2" id="1082066">-&gt; vlan 10 members port 1/3 untagged</p><p class="example2" id="1082069">-&gt; vlan 10 members port 1/4 untagged</p><p class="example2" id="1082072">-&gt; vlan 10 members port 1/5 untagged</p><p class="example2" id="1082937">-&gt; server-cluster 1 port 1/3</p><p class="example2" id="1082967">-&gt; server-cluster 1 port 1/4</p><p class="example2" id="1082997">-&gt; server-cluster 1 port 1/5</p><p class="example2" id="1082075">-&gt; server-cluster 1 vlan 10 port 1/3-5 mac-address 01:00:11:22:33:44</p><p class="heading2" id="1063477"><a id="XREF_71716__Layer_3_Server_Cluster20" name="XREF_71716__Layer_3_Server_Cluster20">Example 2: Layer 3 Server Cluster </a></p><p class="text" id="1073864"><a id="20_text_1073864" name="20_text_1073864"></a>In this example, A server cluster is configured with a unique IP address and a static ARP entry (cluster MAC) and a port list. Here, the server cluster IP address must be a unicast address.<object class="imageSettings" data="../images/HAVLAN-2_FOM_SVG_28.svg" height="369.000671" style="display:block;align:left;" type="image/svg+xml" width="623.039998"></object></p><p class="FigureTitle" id="1073869">Figure 5-3 :  Switch connected to an L3 Server Cluster through 3 ports (1/3,1/4,1/5)</p><p class="bullet" id="1073871"><span class="Bullet_Character">•    </span>The traffic which ingresses on 1/1 or 1/2 destined to the server cluster IP is routed to all the egress ports configured (1/3,1/4,1/5). The ingress ports are on a different VLAN as the server cluster IP interface.</p><p class="bullet" id="1073872"><span class="Bullet_Character">•    </span>However, all the egress ports need to be in the same VLAN as the IP interface of server cluster. The other traffic must be switched according to the normal switching/routing logic.</p><p class="bullet" id="1073873"><span class="Bullet_Character">•    </span>Egress port can be a linkagg port as well.</p><p class="heading3" id="1074420"><span class="Bold" style="font-family : Futura Book ; font-style:normal;font-size : 12.00pt;text-decoration:none;font-kerning:normal;text-transform:none;font-stretch:normal;color:#000000;background-color:transparent;letter-spacing : 0.00em;">Configuration Example</span></p><p class="text" id="1079924">In this example, a packet is an L3 or IP switched packet.</p><p class="step_first" id="1074425"><span class="Futura_Bold">1    </span>Create a server cluster that will become the HA VLAN by using the command <a href="../c_havlan/c_havlan.htm#XREF_94885__server-cluster_name" style="font-weight:Bold;color:#0000ff;background-color:transparent;">server-cluster</a> and configure the mode. For example:</p><p class="example1" id="1078077">-&gt; server-cluster 2 mode L3 admin-state enable</p><p class="step_next" id="1078081"><span class="Futura_Bold">2    </span>Create a default VLAN for the HA VLAN ports with the <a href="../c_vlans/c_vlans.htm#XREF_44597__vlan" style="font-weight:Bold;color:#0000ff;background-color:transparent;">vlan</a> command as shown below:</p><p class="example1" id="1074431">-&gt; vlan 12</p><p class="step_next" id="1074435"><span class="Futura_Bold">3    </span>Assign member ports to the new default VLAN with the <a href="../c_vlans/c_vlans.htm#XREF_27358__vlan_stp" style="font-weight:Bold;color:#0000ff;background-color:transparent;">vlan members untagged</a> and <a href="../c_havlan/c_havlan.htm#XREF_94885__server-cluster_name" style="font-weight:Bold;color:#0000ff;background-color:transparent;">server-cluster</a> commands as shown below:</p><p class="example1" id="1074436">-&gt; vlan 12 members port 1/3 untagged</p><p class="example2" id="1082106">-&gt; vlan 12 members port 1/4 untagged</p><p class="example2" id="1082109">-&gt; vlan 12 members port 1/5 untagged</p><p class="example2" id="1083104">-&gt; server-cluster 2 port 1/3</p><p class="example2" id="1083132">-&gt; server-cluster 2 port 1/4</p><p class="example2" id="1083167">-&gt; server-cluster 2 port 1/5</p><p class="example2" id="1083160"><br/></p><p class="step_next" id="1074440"><span class="Futura_Bold">4    </span>Assign an IP address for the by using the <span class="blue_bold" style="font-weight:Bold;color:#0000ff;background-color:transparent;">ip interface</span> command. For example:</p><p class="example1" id="1078961">-&gt; ip interface &quot;vlan 12&quot; </p><p class="example2" id="1082112">-&gt; ip interface &quot;vlan 12&quot; address 10.135.33.13/24 vlan 12</p><p class="step_next" id="1078938"><span class="Futura_Bold">5    </span>Assign mac-address for the new server cluster by using the command <a href="../c_havlan/c_havlan.htm#XREF_23159__server-cluster_mac-address" style="font-weight:Bold;color:#0000ff;background-color:transparent;">server-cluster mac-address</a>. For example:</p><p class="example1" id="1074441">-&gt; server-cluster 2 ip 10.135.33.12 mac-address static 01:00:6e:22:33:44</p><p></p><div align="left"><table class="Note"><colgroup><col width="600.00px"/></colgroup><tbody><tr height="198.67px"><td><p class="CellBody_note_text" id="1082118"><span class="Bold">Note.  </span><span class="Times_italics" style="font-style:Italic;font-kerning:none;background-color:transparent;">Optional</span>. You can display the configuration of high availability VLANs with the <a href="../c_havlan/c_havlan.htm#XREF_83055__show_server-cluster" style="font-weight:Bold;font-kerning:none;color:#0000ff;background-color:transparent;">show server-cluster</a><span class="Times_Bold" style="font-weight:Bold;font-kerning:none;background-color:transparent;"> </span>command. For example:</p><p class="screen2" id="1082144"><br/></p><p class="screen2" id="1082172">-&gt; show server-cluster 2</p><p class="screen2" id="1082173">Cluster Id : 2,</p><p class="screen2" id="1082174">Cluster Name : L3-cluster,</p><p class="screen2" id="1082225">Cluster Mode : L3,</p><p class="screen2" id="1082226">Cluster Mac-address : 01:10:11:22:33:44,</p><p class="screen2" id="1082227">Cluster Vlan : 12,</p><p class="screen2" id="1082178">Administrative State: Enabled,</p><p class="screen2" id="1082179">Operational State : Enabled,</p><p class="screen2" id="1082152">Operational Flag : -</p></td></tr></tbody></table></div><p></p><p class="text" id="1074457">An example of what these commands look like entered sequentially on the command line:</p><p class="example1" id="1078981">-&gt; server-cluster 2 mode L3 admin-state enable</p><p class="example2" id="1082247">-&gt; vlan 12</p><p class="example2" id="1082250">-&gt; vlan 12 members port 1/3 tagged</p><p class="example2" id="1082253">-&gt; vlan 12 members port 1/4 tagged</p><p class="example2" id="1082256">-&gt; vlan 12 members port 1/5 tagged</p><p class="example2" id="1083224">-&gt; server-cluster 2 port 1/3</p><p class="example2" id="1083256">-&gt; server-cluster 2 port 1/4</p><p class="example2" id="1083286">-&gt; server-cluster 2 port 1/5</p><p class="example2" id="1082259">-&gt; ip interface &quot;vlan 12&quot;</p><p class="example2" id="1082262">-&gt; ip interface &quot;vlan 12&quot; address 10.135.33.13/24 vlan 12</p><p class="example2" id="1082265">-&gt; server-cluster 2 ip 10.135.33.12 mac-address static 01:00:6e:22:33:44</p><p class="heading2" id="1073993"><a id="XREF_74305__Layer_3_Server_Cluster_%13_IP_Multicast_Address_to20" name="XREF_74305__Layer_3_Server_Cluster_%13_IP_Multicast_Address_to20"></a>Example 3: Layer 3 Server Cluster with IP Multicast Address to Cluster (IGMP)</p><p class="text" id="1073954">This example shows that a server cluster can be configured with a unique IP address and a IP multicast address. For this scenario, the server cluster IP address needs to be a unicast address and the MAC address (ARP entry) can be unicast or L2 multicast or IP multicast. The MAC address must be configured through CLI ARP resolution to a server cluster MAC, and must be configured before actual routing</p><p class="text" id="1074005">.<img align="" alt="HAVLAN-3" class="imageSettings" height="auto" preserveaspectratio="none" src="../images/HAVLAN-3.png" style="display:block;align:left;" width="451.999512" x="85.520243" y="3.000814"/></p><p class="FigureTitle" id="1073958">Figure 5-4 :  Switch connected to an L3 Server Cluster (IGMP) through 3 ports (1/3,1/4,1/5)</p><p class="bullet" id="1073959"><span class="Bullet_Character">•    </span>There is no provision for port list configuration and Ports are derived dynamically using the IGMP snooping of the reports from the server cluster (IGMP v2 reports).</p><p class="bullet" id="1073960"><span class="Bullet_Character">•    </span>The traffic which ingresses on 1/1 or 1/2 destined to the server cluster IP is routed to all the ports which are members of the IP multicast group of the server cluster.</p><p class="bullet" id="1073961"><span class="Bullet_Character">•    </span>The ingress ports is on a different VLAN as the server cluster IP interface. Join and Leave messaged keep updating the egress port list. However all the egress ports need to be in the same VLAN as the IP interface of server cluster.</p><p class="bullet" id="1073962"><span class="Bullet_Character">•    </span>The other traffic is switched according to the normal switching/routing logic.</p><p class="bullet" id="1073963"><span class="Bullet_Character">•    </span>Egress port can be a linkagg port as well.</p><p></p><div align="left"><table class="Note"><colgroup><col width="600.00px"/></colgroup><tbody><tr height="38.00px"><td><p class="CellBody_note_text" id="1082299"><span class="Bold">Note.  </span>When a server cluster tries to send a bridged or routed packet to itself, a copy of the packet goes back to the sender’s (server cluster) port.</p></td></tr></tbody></table></div><p></p><p class="heading3" id="1078734"><span class="Bold" style="font-family : Futura Book ; font-style:normal;font-size : 12.00pt;text-decoration:none;font-kerning:normal;text-transform:none;font-stretch:normal;color:#000000;background-color:transparent;letter-spacing : 0.00em;">Configuration Example</span></p><p class="text" id="1078735">In this example, a packet is an L3 IP switched packet and Egress port can also be a linkagg port.</p><p class="step_first" id="1078739"><span class="Futura_Bold">1    </span>Create a server cluster that will become the HA VLAN by using the command <a href="../c_havlan/c_havlan.htm#XREF_94885__server-cluster_name" style="font-weight:Bold;color:#0000ff;background-color:transparent;">server-cluster</a> and configure the mode. For example:</p><p class="example1" id="1078740">-&gt; server-cluster 3 mode L3 admin-state enable</p><p class="step_next" id="1078744"><span class="Futura_Bold">2    </span>Create a default VLAN for the HA VLAN ports with the <a href="../c_vlans/c_vlans.htm#XREF_44597__vlan" style="font-weight:Bold;color:#0000ff;background-color:transparent;">vlan</a> command as shown below:</p><p class="example1" id="1078745">-&gt; vlan 12</p><p class="step_next" id="1078749"><span class="Futura_Bold">3    </span>Assign member ports to the new default VLAN with the <a href="../c_vlans/c_vlans.htm#XREF_27358__vlan_stp" style="font-weight:Bold;color:#0000ff;background-color:transparent;">vlan members untagged</a> and <a href="../c_havlan/c_havlan.htm#XREF_94885__server-cluster_name" style="font-weight:Bold;color:#0000ff;background-color:transparent;">server-cluster</a> commands as shown below:</p><p class="example1" id="1078750">-&gt; vlan 12 members port 1/3 untagged</p><p class="example2" id="1082348">-&gt; vlan 12 members port 1/4 untagged</p><p class="example2" id="1082351">-&gt; vlan 12 members port 1/5 untagged</p><p class="example2" id="1083380">-&gt; server-cluster 3 port 1/3</p><p class="example2" id="1083410">-&gt; server-cluster 3 port 1/4</p><p class="example2" id="1083440">-&gt; server-cluster 3 port 1/5</p><p class="step_next" id="1078754"><span class="Futura_Bold">4    </span>Assign mac-address for the new server cluster by using the command <a href="../c_havlan/c_havlan.htm#XREF_23159__server-cluster_mac-address" style="font-weight:Bold;color:#0000ff;background-color:transparent;">server-cluster mac-address</a>. For example:</p><p class="example1" id="1078755">-&gt; server-cluster 3 ip 10.135.33.12 mac-address static 01:00:11:22:33:44 </p><p class="step_next" id="1079013"><span class="Futura_Bold">5    </span>If you want to assign a dynamic mac-address for the server cluster, enter the command as follows:</p><p class="example1" id="1079017">-&gt; server-cluster 3 ip 10.135.33.12 mac-address dynamic</p><p class="step_next" id="1078799"><span class="Futura_Bold">6    </span>Enable the admin state of the IP multicast by using the <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">ip multicast admin-state enable</span> command. IP multicast admin state should be enabled for the IGMP reports to be processed., else the cluster will be operationally down. </p><p class="example1" id="1078813">-&gt; ip multicast admin-state enable</p><p class="example2" id="1082354">-&gt; server-cluster 3 igmp-mode enable</p><p class="example2" id="1082357">-&gt; server-cluster 3 ip-multicast 225.0.0.23</p><p class="text" id="1079037">When IGMP mode is enabled for the server cluster, all static ports will be reset in igmp mode.</p><p></p><div align="left"><table class="Note"><colgroup><col width="600.00px"/></colgroup><tbody><tr height="242.67px"><td><p class="CellBody_note_text" id="1082366"><span class="Bold">Note.  </span><span class="Times_italics" style="font-style:Italic;font-kerning:none;background-color:transparent;">Optional</span>. You can display the configuration of high availability VLANs with the <a href="../c_havlan/c_havlan.htm#XREF_83055__show_server-cluster" style="font-weight:Bold;font-kerning:none;color:#0000ff;background-color:transparent;">show server-cluster</a><span class="Times_Bold" style="font-weight:Bold;font-kerning:none;background-color:transparent;"> </span>command. For example:</p><p class="screen2" id="1082388"><br/></p><p class="screen2" id="1082398">-&gt; show server-cluster 3</p><p class="screen2" id="1082399">Cluster Id               : 3,</p><p class="screen2" id="1082400">Cluster Name             : -,</p><p class="screen2" id="1082401">Cluster Mode             : L3,</p><p class="screen2" id="1082402">Cluster IP               : 10.135.33.12,</p><p class="screen2" id="1082403">Cluster Mac-Address      : 01:00:11:22:33:44,</p><p class="screen2" id="1082404">Cluster Mac Type         : Static,</p><p class="screen2" id="1082405">IGMP-Mode                : Enabled,</p><p class="screen2" id="1082406">Cluster Multicast IP     : 225.0.0.23,</p><p class="screen2" id="1082407">Administrative State     : Enabled,</p><p class="screen2" id="1082408">Operational State        : Disabled,</p><p class="screen2" id="1082409">Operational Flag         : No IGMP members</p></td></tr></tbody></table></div><p></p><p class="text" id="1079125">An example of what these commands look like entered sequentially on the command line:</p><p class="example1" id="1079083">-&gt; server-cluster 3 mode L3 admin-state enable</p><p class="example2" id="1082425">-&gt; vlan 12</p><p class="example2" id="1082428">-&gt; vlan 12 members port 1/3 untagged</p><p class="example2" id="1082431">-&gt; vlan 12 members port 1/4 untagged</p><p class="example2" id="1082434">-&gt; vlan 12 members port 1/5 untagged</p><p class="example2" id="1083496">-&gt; server-cluster 3 port 1/3</p><p class="example2" id="1083526">-&gt; server-cluster 3 port 1/4</p><p class="example2" id="1083556">-&gt; server-cluster 3 port 1/5</p><p class="example2" id="1082437">-&gt; server-cluster 3 ip 10.135.33.12 mac-address static 01:00:11:22:33:44 </p><p class="example2" id="1082440">-&gt; ip multicast admin-state enable </p><p class="example2" id="1082443">-&gt; server-cluster 3 igmp-mode enable</p><p class="example2" id="1082446">-&gt; server-cluster 3 ip-multicast 225.0.0.23</p><p></p><div align="left"><table class="Note"><colgroup><col width="600.00px"/></colgroup><tbody><tr height="38.00px"><td><p class="CellBody_note_text" id="1082452"><span class="Bold">Note.  </span>In order to process IGMP reports, it is required to enable IP mulitcast by using the <span class="Times_Bold" style="font-weight:Bold;font-kerning:none;background-color:transparent;">ip multicast admin-state enable</span> command.</p></td></tr></tbody></table></div><p></p><p class="heading1" id="1063748"><a id="XREF_97220__Using_Show_Commands20" name="XREF_97220__Using_Show_Commands20">Displaying High Availability VLAN Status</a></p><p class="text" id="1058789"><a id="20_text_1058789" name="20_text_1058789"></a><a id="high_availability_VLANs:displaying" data-indexterm="high availability VLANs:displaying"></a><a id="index_1058788" name="index_1058788"></a>You can use CLI <span class="Times_Bold" style="font-weight:Bold;background-color:transparent;">show</span> commands to display the current configuration and statistics of high availability VLANs on a switch. These commands include the following:</p><div align="left"><table class="Related_Cmds"><colgroup><col width="192.00px"/><col width="408.00px"/></colgroup><tbody><tr height="22.00px"><td><p class="CellBody_cli_cmd" id="1058795" style="font-kerning:none;"><span style="font-weight:normal;"><a href="../c_havlan/c_havlan.htm#XREF_83055__show_server-cluster" style="color:#0000ff;background-color:transparent;">show server-cluster</a></span></p></td><td><p class="CellBody" id="1058797">Displays the server clusters configured in the system.</p></td></tr><tr height="54.00px"><td><p class="CellBody_cli_cmd" id="1058802" style="font-kerning:none;"><span class="Times_Bold" style="background-color:transparent;"><a href="../c_vlans/c_vlans.htm#XREF_33547__show_vlan" style="color:#0000ff;background-color:transparent;">show vlan</a></span></p></td><td><p class="CellBody" id="1058804">Displays a list of all VLANs configured on the switch and the status of related VLAN properties (e.g., admin and Spanning Tree status and router port definitions).</p></td></tr><tr height="22.00px"><td><p class="CellBody_cli_cmd" id="1058809"><a href="../c_vlans/c_vlans.htm#XREF_20636__show_vlan_ports" style="font-kerning:none;color:#0000ff;background-color:transparent;">show vlan members</a></p></td><td><p class="CellBody" id="1058811">Displays a list of VLAN port assignments. </p></td></tr></tbody></table></div><p></p><p class="text" id="1072590">To display the status and configuration of high availability VLANs you use the <a id="{index}show_mac-address-table_port-mac{Default_Para_Font}_command" data-indexterm="{index}show mac-address-table port-mac{Default Para Font} command"></a><a id="index_1072586" name="index_1072586"></a><a href="../c_havlan/c_havlan.htm#XREF_83055__show_server-cluster" style="font-weight:Bold;color:#0000ff;background-color:transparent;">show server-cluster</a> command. To display the status and configuration of all high availability VLANs on a switch, enter the following command:</p><p class="example1" id="1072591">-&gt; show server-cluster</p><p class="text" id="1072592">A screen similar to the following will be displayed:</p><p class="screen" id="1072567">-&gt; show server-cluster</p><p class="screen" id="1072568">Legend: * = not valid</p><p class="screen2" id="1072569"><br/></p><p class="screen2" id="1072570">Cluster       Mode    Vlan    Mac Address          Ip Address       IGMP Address          Name</p><p class="screen2" id="1072571">---------+-----+-----+-------------------+---------------+-------------+-----------</p><p class="screen2" id="1072572">* 10       L2    100    01:10:11:22:33:44              -          -       cluster1</p><p class="screen2" id="1072573">  11       L2    100    01:10:11:22:33:44              -          -       cluster2</p><p class="screen2" id="1072574">  12       L2    100    01:10:11:22:33:44          -                -       -</p><p class="screen2" id="1072575">  13       L3    -    01:12:11:22:33:44    10.135.33.203                -       -</p><p class="screen2" id="1072576">* 14       L3    -    01:12:11:22:33:45    10.135.33.203                -      -</p><p class="screen2" id="1072577">  15       L3    -    01:00:6e:00:00:44    10.135.33.203             225.0.1.2          cluster-igmp</p><p class="text" id="1065323">To display the status and configuration of a single high availability VLAN cluster enter <a href="../c_havlan/c_havlan.htm#XREF_83055__show_server-cluster" style="font-weight:Bold;color:#0000ff;background-color:transparent;">show server-cluster</a> followed by the server cluster ID number. For example, to display the status and configuration of high availability server cluster id “1”, enter the following command:</p><p class="example1" id="1060134">-&gt; show server-cluster 1</p><p class="text" id="1059690">A screen similar to the following will be displayed:</p><p class="screen" id="1082523">-&gt; show server-cluster 1</p><p class="screen2" id="1082524">Cluster Id : 1,</p><p class="screen2" id="1082525">Cluster Name : L2-cluster,</p><p class="screen2" id="1072599">Cluster Mode : L2,</p><p class="screen2" id="1072600">Cluster Mac-address : 01:10:11:22:33:44,</p><p class="screen2" id="1072601">Cluster Vlan : 12,</p><p class="screen2" id="1072602">Administrative State: Enabled,</p><p class="screen2" id="1082531">Operational State : Disabled,</p><p class="screen2" id="1082532">Operational Flag : VPA is not forwarding</p><p></p><div align="left"><table class="Note"><colgroup><col width="600.00px"/></colgroup><tbody><tr height="38.00px"><td><p class="CellBody_note_text" id="1082541"><span class="Bold">Note.  </span>For more information on the CLI commands, See the <span class="Times_italics" data-keyref="CLI Reference Guide" style="font-family : Times New Roman ; font-weight:normal;font-style:Italic;font-size : 10.50pt;text-decoration:none;font-kerning:none;text-transform:none;font-stretch:normal;color:#000000;background-color:transparent;letter-spacing : 0.00em;">OmniSwitch AOS Release 8 CLI Reference Guide</span>.</p></td></tr></tbody></table></div><p></p></div></div>
          <div class="RH-LAYOUT-BRS-container" id="rh-brs"></div>
        </div>
        <div class="RH-LAYOUT-RIGHTPANEL-container" id="rh-rightpanel"></div>
      </div>
    </div>
  </main>
  <footer role="contentinfo" class="RH-LAYOUT-FOOTER-container" id="rh-footer"></footer>
  <script type="text/javascript">//<![CDATA[

    gRootRelPath = "../.."
    gCommonRootRelPath = "../.."
    gTopicId = "2.0_7"
  
//]]></script>


  <script src="../../template/scripts/topicpage.js"></script>
  <script src="../../whxdata/layoutconfig.js"></script>
  <script src="../../whxdata/brsdata.js"></script>

  
    
      
          
      
          

            
              
                  
              
                <link rel="StyleSheet" href="../../template/Studio/font.css" type="text/css"/>
                
                  


</body></html>