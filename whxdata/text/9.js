rh._.exports({"0":[["n_vlans"]],"1":[[" ","4    ","Configuring ","VLANs","In a flat bridged network, a broadcast domain is confined to a single LAN segment or even a specific physical location, such as a department or building floor. In a switch-based network, such as one comprised of OmniSwitch systems, a broadcast domain, or VLAN can span multiple physical switches and can include ports from a variety of media types. For example, a single VLAN could span three different switches located in different buildings and include a variety of Ethernet port configurations, such as 802.1q tagged VLAN member ports and/or a link aggregate of ports.","In This Chapter","This chapter describes how to define and manage VLAN configurations through the Command Line Interface (CLI). CLI commands are used in the configuration examples; for more details about the syntax of commands, see the ","OmniSwitch AOS Release 8 CLI Reference Guide",".","Configuration procedures described in this chapter include:","•    ","“Creating/Modifying VLANs” on page 4-4",".","•    ","“Assigning Ports to VLANs” on page 4-6",".","•    ","“Enabling/Disabling Spanning Tree for a VLAN” on page 4-9",".","•    ","“Enabling/Disabling Source Learning” on page 4-9",".","•    ","“Configuring VLAN IP Interfaces” on page 4-10",".","•    ","“Bridging VLANs Across Multiple Switches” on page 4-11",".","•    ","“Verifying the VLAN Configuration” on page 4-13",".","•    ","“Using Private VLANs” on page 4-15",".","For information about Spanning Tree, see ","Chapter 6, “Configuring Spanning Tree Parameters.”"," ","For information about routing, see ","Chapter 19, “Configuring IP.”","VLAN ","Defaults ","Parameter Description","Command","Default","VLAN identifier (VLAN ID)","vlan","VLAN 1 predefined on each switch.","VLAN administrative state","vlan","Enabled","VLAN description","vlan"," ","name","VLAN ID","VLAN Spanning Tree state","spantree vlan admin-state","Enabled","VLAN IP router interface","ip interface","None","VLAN port associations","vlan members untagged","All ports are initially associated with default VLAN 1.","Sample ","VLAN Configuration","The following steps provide a quick tutorial to create VLAN 100. Also included are steps to define a VLAN description, IP router interface, and static switch port assignments.","Note.  ","Optional."," Creating a new VLAN involves specifying a VLAN ID that is not already assigned to an existing VLAN. To determine if a VLAN already exists in the switch configuration, enter ","show vlan",". If VLAN 100 does not appear in the ","show vlan"," output, then it does not exist on the switch. For example:","-> show vlan","vlan  type  admin  oper  ip   mtu   name","-----+------+-----+-----+-----+-----+------------","   1   std    Ena   Dis   Dis  1500   VLAN 1","1    ","Create VLAN 100 with a description (for example, Finance IP Network) using the following command:","-> vlan 100 name “Finance IP Network”","2    ","Define an IP interface using the following command to assign an IP host address of 21.0.0.10 to VLAN 100 that enables forwarding of VLAN traffic to other subnets:","-> ip interface vlan_100_ip address 21.0.0.10 vlan 100","3    ","Assign switch ports 2 through 4 on slot 3 to VLAN 100 using the following command:","-> vlan 100 members port 3/2-4 untagged","Note.  ","Optional",". To verify the VLAN 100 configuration, use the ","show vlan"," command. For example:","-> show vlan 100","Name                                    : Finance IP Network,","Type                                                                                          : Static Vlan,","Administrative State                 : Enabled,","Operational State                       : Disabled,","IP Router Port                          : 21.0.0.10  255.0.0.0  forward  e2,","IP MTU                   : 1500","To verify that ports 3/2-4 were assigned to VLAN 100, use the ","show vlan members"," command. For example:","-> show vlan 100 members","  port     type      status","--------+---------+--------------","   3/2    untagged  inactive","   3/3    untagged  inactive","   3/4    untagged  inactive","To verify the details about the specific VLAN port 3/2, use the ","show vlan members"," command with the ","port"," keyword and port number. For example:","-> show vlan 100 members port 3/2","type       : untagged,","status     : inactive,","vlan admin : disabled,","vlan oper  : disabled,","VLAN Management Overview","One of the main benefits of using VLANs to segment network traffic, is that VLAN configuration and port assignment is handled through switch software. This eliminates the need to physically change a network device connection or location when adding or removing devices from the VLAN broadcast domain. The OmniSwitch VLAN management software handles the following VLAN configuration tasks:","•    ","Creating or modifying VLANs.","•    ","Assigning or changing default VLAN port associations (VPAs).","•    ","Enabling or disabling VLAN participation in the current Spanning Tree algorithm.","•    ","Displaying VLAN configuration information.","In addition to the above tasks, VLAN management software tracks and reports the following information to other switch software applications:","•    ","VLAN configuration changes, such as adding or deleting VLANs, modifying the status of VLAN properties (for example, administrative, Spanning Tree, and authentication status), changing the VLAN ","description, or configuring VLAN router interfaces.","•    ","VLAN port associations triggered by VLAN management and other switch software applications, such as 802.1Q VLAN tagging.","•    ","The VLAN operational state, which is inactive until at least one active switch port is associated with the VLAN. ","Creating/Modifying VLANs","The initial configuration for all OmniSwitch consists of a default VLAN 1 and all switch ports are initially assigned to this VLAN. When a switching module is added to the switch, the physical ports are also assigned to VLAN 1. If additional VLANs are not configured on the switch, then the entire switch is treated as one large broadcast domain. All ports receive traffic from all other ports. ","In compliance with the IEEE 802.1Q standard, each VLAN is identified by a unique number, referred to as the ","“","VLAN ID”",". The user specifies a VLAN ID to create, modify or remove a VLAN and to assign switch ports to a VLAN. When a packet is received on a port, the VLAN ID of the port is inserted into the packet. The packet is then bridged to other ports that are assigned to the same VLAN ID. In essence, the VLAN broadcast domain is defined by a collection of ports and packets assigned to its VLAN ID.","The ","operational status of a VLAN remains inactive until at least one active switch port is assigned to the VLAN. This means that VLAN properties, such as Spanning Tree or router interfaces, also remain inactive. Ports are considered active if they are connected to an active network device. Non-active port assignments are allowed, but do not change the operational state of the VLAN.","Ports can be statically assigned to VLANs. When a port is assigned to a VLAN, a VLAN port association (VPA) is created and tracked by VLAN management switch software. For more information about VPAs, see ","“Assigning Ports to VLANs” on page 4-6",".","Adding/Removing a VLAN","To add a VLAN to the switch configuration, enter ","vlan"," followed by a unique VLAN ID, an optional administrative status,"," ","and an optional description. For example, the following command creates VLAN 755 with a description:","-> vlan 755 name “IP Finance Network”","By default, administrative status and Spanning Tree are enabled when the VLAN is created. The ","name"," parameter for a VLAN is optional. ","Note.  ","Quotation marks are required if the description contains multiple words separated by spaces. If the description consists of only one word or multiple words separated by another character, such as a hyphen, then quotes are not required.","You can also specify a contiguous range of VLAN IDs by using a hyphen with the ","vlan"," command. For example, the following commands create VLANs 10 through 15 and 100 through 105 on the switch:","-> vlan 10-15 name “Marketing Network”","-> vlan 100-105 name “Marketing Network”","To remove a VLAN from the switch configuration, use the ","no"," form of the ","vlan"," command.","-> no vlan 200","-> no vlan 100-105","-> no vlan 10-15","When a VLAN is deleted, any router interfaces defined for the VLAN are removed and all VLAN port associations are dropped. If the VLAN deleted is the default VLAN for a port, the port returns to default VLAN 1. If the VLAN deleted is not a default VLAN, then the ports are directly detached from the VLAN. For more information about VLAN router interfaces, see ","“Configuring VLAN IP Interfaces” on page 4-10",". ","To view a list of VLANs already configured on the switch, use the ","show vlan"," command. See ","“Verifying the VLAN Configuration” on page 4-13"," for more information.","Enabling/Disabling the VLAN Administrative Status","To enable or disable the administrative status for an existing VLAN, enter ","vlan"," followed by an existing VLAN ID and either ","enable"," or ","disable",". ","-> vlan 7 admin-state disable","-> vlan 1 admin-state enable","When the administrative status for a VLAN is disabled, VLAN port assignments are retained but traffic is not forwarded on these ports. ","Modifying the VLAN Description","To change the description for a VLAN, enter ","vlan"," followed by an existing VLAN ID and the keyword ","name"," followed by the new description. For example, the following command changes the description for VLAN 455 to “Marketing IP Network”:","-> vlan 455 name “Marketing IP Network”","Assigning Ports to VLANs","The OmniSwitch supports static assignment of physical switch ports to a VLAN. Once the assignment occurs, a VLAN port association (VPA) is created and tracked by VLAN management software on each switch. To view current VLAN port assignments in the switch configuration, use the ","show vlan members"," command. ","Methods for statically assigning ports to VLANs include the following:","•    ","Using the ","vlan members untagged"," command to define a new configured default VLAN for fixed ports. See ","“Changing the Default VLAN Assignment for a Port” on page 4-6",".","•    ","Using the ","vlan members tagged"," command to define 802.1Q-tagged VLANs for fixed ports. This method allows the switch to bridge traffic for multiple VLANs over one physical port connection. See ","“Using 802.1Q Tagging” on page 4-7",".","•    ","Configuring ports as members of a link aggregate that is assigned to a configured default VLAN. (See ","Chapter 9, “Configuring Static Link Aggregation,”"," for more information.)","Changing the Default VLAN Assignment for a Port","Initially all switch ports are assigned to VLAN 1, which is also their ","configured default ","VLAN. When additional VLANs are created on the switch, ports are ","assigned to the VLANs so that traffic from devices connected to these ports is bridged within the VLAN domain. ","NNI interface can also be configured with normal VLANs (other than VLAN 1) using this command. This allows NNI ports to carry untagged packets for the specified VLAN ID.","To assign a switch port to a new default VLAN, use the ","vlan members untagged"," command. For example, the following command assigns port 5 on slot 2 to VLAN 955:","-> vlan 955 members port 2/5 untagged","When the ","vlan members ","command is used, the port’s default VLAN assignment is changed to the specified VLAN. The previous default VLAN assignment for the port (for example, VLAN 1, VLAN 10 or VLAN 200) is dropped. ","The ","vlan members ","command is also used to change the default VLAN assignment for an aggregate of ports. The link aggregate control number is specified instead of a slot and port. For example, the following command assigns link aggregate 10 to VLAN 755:","-> vlan 755 members linkagg 10 untagged","For more information about configuring an aggregate of ports, see ","Chapter 9, “Configuring Static Link Aggregation.”","Use the ","no"," form of the ","vlan members ","command to remove a default VPA. When this is done, VLAN 1 is restored as the default VLAN for the port. ","-> no vlan 955 members port 2/5","Using 802.1Q Tagging","Another method for assigning ports to VLANs involves configuring a switch port or link aggregate to process 802.1Q-tagged frames that contain a specific VLAN ID designation. This method, referred to as 802.1Q tagging (or trunking), allows a single network link to carry traffic for multiple VLANs. ","The OmniSwitch implements the IEEE 802.1Q standard for sending frames through the network tagged with VLAN identification. This section details procedures for configuring and monitoring 802.1Q tagging on a single switch port or link aggregate group.","“Tagged” refers to four bytes of reserved space in the header of the packet. The four bytes of “tagging” are broken down as follows: the first two bytes indicate whether the packet is an 802.1Q packet, and the next two bytes carry the VLAN identification (VID) and priority.","When packets ingress the switch, they are classified into a VLAN based on their 802.1Q tag information. ","•    ","If the packet contains an 802.1Q tag, the VLAN ID in the tag must match either the default VLAN ID for the port or a VLAN ID for which the port is tagged. If there is no match, the packet is dropped.","•    ","If the packet is not tagged at all, the packet is placed into the default VLAN to which the port that received the packet is assigned. ","The following diagram illustrates a simple network by using tagged and untagged traffic:","Figure 4-1 : Tagged and Untagged Traffic Network","Switch 1 and 2 have three VLANs, one for untagged traffic and two for tagged traffic. The ports connecting Switch 1 and 2 are configured in such a manner that the ports accept both tagged traffic for VLANS 2 and 3 and untagged traffic for VLAN 1. ","A port can only be assigned to one untagged VLAN (in every case, this is the default VLAN configuration). In this example the default VLAN for port 2/1 and port 4/3 is VLAN 1. The port can be assigned to as many 802.1Q-tagged VLANs as necessary.","Configuring 802.1Q Tagging","To set a port to be a tagged port, use the ","vlan members tagged"," command and specify a VLAN identification (VID) number and a port number. ","NNI ports can also be tagged with normal VLANs using this command. This allows NNI ports to carry regular 802.1q tagged traffic as well as SVLAN tagged traffic. 802.1q VLAN tagging to an NNI interface will not be allowed if the interface is set with TPID other than 0x8100.","For example, to configure port 3/4 to carry traffic for VLAN 5, enter the following command at the CLI prompt:","-> vlan 5 members port 4/3 tagged ","Port 4/3 is now configured to carry packets tagged with VLAN 5, even though VLAN 5 is not the default VLAN for the port. ","To enable tagging on link aggregation groups, enter the link aggregation group identification number in place of the slot and port number, as shown:","-> vlan 5 members linkagg 8 tagged","(For further information on creating link aggregation groups, see ","Chapter 9, “Configuring Static Link Aggregation,”"," or ","Chapter 10, “Configuring Dynamic Link Aggregation.”",")","To remove 802.1Q tagging from a selected port or link aggregate, use the ","untagged"," parameter. ","-> vlan 5 members linkagg 8 untagged ","To display all VLANs, enter the following command:","-> show vlan port","Note.  ","The link aggregation group must be created first before it can be set to use 802.1Q tagging.","Enabling/Disabling Spanning Tree for a VLAN","The Spanning Tree operating mode for the switch determines how VLAN ports are evaluated to identify redundant data paths. If the ","Spanning Tree switch operating mode is set to ","flat",", then VLAN port connections are checked against other VLAN port connections for redundant data paths. ","Note.  ","The single flat mode STP instance is referred to as the CIST (Common and Internal Spanning Tree) instance. ","In the flat mode, if the CIST instance is disabled, then it is disabled for all configured VLANs. However, disabling STP on an individual VLAN excludes only those VLAN ports from the flat STP algorithm. ","If the ","Spanning Tree operating mode is set to ","per-vlan ","mode",", there is a single Spanning Tree instance for each VLAN broadcast domain. Enabling or disabling STP on a VLAN in this mode includes or excludes the VLAN from the per-vlan STP algorithm.","The ","spantree vlan admin-state"," command is used to enable or disable a Spanning Tree instance for an existing VLAN. In the following examples, Spanning Tree is disabled on VLAN 255 and enabled on VLAN 755:","-> spantree vlan 255 admin-state disable","-> spantree vlan 755 admin-state enable ","STP does not become operationally active on a VLAN unless the VLAN is operationally active, which occurs when at least one active port is assigned to the VLAN. Also, STP is enabled/disabled on individual ports. So even if STP is enabled for the VLAN, a port assigned to that VLAN must also have STP enabled. See ","Chapter 6, “Configuring Spanning Tree Parameters.”","Enabling/Disabling Source Learning","Source learning can be disabled on a VLAN. Disabling source learning can be beneficial in a ring topology. There is no limit on the number of ports that can belong to a VLAN that has source learning disabled, but it is recommended to include only the two ports connecting the switch to a ring. ","To enable or disable source learning on a VLAN, use the ","mac-learning static mac-address"," command. For example, the following commands disable and enabled source learning on VLAN 10:","-> mac-learning vlan 10 disable","-> mac-learning vlan 10 enable","Disabling source learning on a VLAN causes the VLAN to be flooded with unknown unicast traffic. ","Configuring VLAN IP Interfaces","Network device traffic is bridged (switched) at the Layer 2 level between ports that are assigned to the same VLAN. However, if a device needs to communicate with another device that belongs to a different VLAN, then Layer 3 routing is necessary to transmit traffic between the VLANs. Bridging makes the decision on where to forward packets based on the destination MAC address of the packet; routing makes the decision on where to forward packets based on the IP network address assigned to the packet (for example, 21.0.0.10). ","The OmniSwitch supports the routing of IP traffic. A VLAN is available for routing when at least one IP interface is defined for that VLAN and at least one active port is associated with the VLAN. Up to eight IP interfaces can be configured for each VLAN. ","If a VLAN does not have an IP interface, the ports associated with that VLAN are in essence firewalled from other VLANs. For information about configuring IP interfaces, see ","Chapter 19, “Configuring IP.”","Bridging VLANs Across Multiple Switches","To create a VLAN ","bridging domain"," that extends across multiple switches:","1    ","Create a VLAN on each switch with the same VLAN ID number (for example, VLAN 10).","2    ","On each switch, assign the ports that provide connections to other switches to the VLAN created in Step 1. ","3    ","On each switch, assign the ports that provide connections to end user devices (for example, workstations) to the VLAN created in Step 1. ","4    ","Connect switches and end user devices to the assigned ports.","The following diagram shows the physical configuration of an example VLAN bridging domain:","Figure 4-2 :  VLAN Bridging Domain: Physical Configuration","In the above diagram, VLAN 10 exists on all four switches and the connection ports between these switches are assigned to VLAN 10. The workstations can communicate with each other because the ports to which they are connected are also assigned to VLAN 10. It is important to note that connection cables do not have to connect to the same port on each switch. The key is that the port must belong to the same VLAN on each switch. To carry multiple VLANs between switches across a single physical connection cable, use the 802.1Q tagging feature (see ","“Using 802.1Q Tagging” on page 4-7","). ","The connection between Switch C and D is shown with a broken line because the ports that provide this connection are in a blocking state. Spanning Tree is active by default on all switches, VLANs and ports. The Spanning Tree algorithm determined that if all connections between switches were active, a network loop would exist that could cause unnecessary broadcast traffic on the network. The path between Switch C and D was shut down to avoid such a loop. See ","Chapter 6, “Configuring Spanning Tree Parameters,”"," for information about how Spanning Tree configures network topologies that are loop free.","The following diagram shows the same bridging domain example as seen by the end user workstations. Because traffic between these workstations is ","bridged"," across physical switch connections within the VLAN 10 domain, the workstations are basically unaware that the switches even exist. Each workstation believes that the others are all part of the same VLAN, even though they are physically connected to different switches.","Figure 4-3 :  VLAN Bridging Domain: Logical View","Creating a VLAN bridging domain across multiple switches allows VLAN members to communicate with each other, even if they are not connected to the same physical switch. This is how a logical grouping of users can traverse a physical network setup without routing and is one of the many benefits of using VLANs.","Verifying the VLAN Configuration","To display information about the VLAN configuration for a single switch use the show commands listed below:","show vlan","Displays a list of all VLANs configured on the switch and the status of related VLAN properties (for example, admin and Spanning Tree status and router port definitions).","show vlan members","Displays a list of VLAN port assignments. ","show ip interface","Displays VLAN IP router interface information. ","Understanding Port Output Display","Each line of the ","show vlan members"," output display corresponds to a single VLAN port association (VPA). In addition to showing the VLAN ID and slot/port number, the VPA type and current status of each association are also provided. ","The VPA type indicates that one of the following methods was used to create the VPA:","Type","Description","untagged","The port was statically assigned to the VLAN using the ","vlan members untagged"," command. The VLAN is now the configured default VLAN for the port.","t","agged","The port was statically assigned to the VLAN using the ","vlan members tagged"," command. The VLAN is a static secondary VLAN for the 802.1Q tagged port. ","mirror","The port is assigned to the VLAN because it is configured to mirror another port that is assigned to the same VLAN. For more information about the Port Mirroring feature, see ","Chapter 39, “Diagnosing Switch Problems.”","The VPA status indicates one of the following:","Status","Description","inactive","Port is not active (administratively disabled, down, or nothing connected to the port) for the VPA.","blocking","Port is active, but not forwarding traffic for the VPA.","forwarding","Port is forwarding all traffic for the VPA.","filtering","Mobile port traffic is filtered for the VPA; only traffic received on the port that matches VLAN rules is forwarded. Occurs when a mobile port’s VLAN is administratively disabled or the port’s default VLAN status is disabled. Does not apply to fixed ports.","The following example displays the VPA information for all ports in VLAN 200:","-> show vlan 200 members","  port     type      status","--------+---------+--------------","   3/24   untagged    inactive","   5/12   tagged      blocking","The above example output provides the following information:","•    ","VLAN 200 is the configured default VLAN for port 3/24, which is currently not active.","•    ","VLAN 200 is an 802.1Q-tagged VLAN for port 5/12, which is an active port but currently blocked from forwarding traffic.","For more information about the resulting displays from these commands, see the ","OmniSwitch AOS Release 8 CLI Reference Guide",".","Using Private VLANs","The Private VLAN (PVLAN) feature provides the ability to isolate Layer 2 data between devices that are on the same VLAN. This type of data isolation improves security and simplifies system configuration. ","A standard VLAN usually represents a single broadcast domain, but a PVLAN divides a VLAN (Primary) into sub-VLANs (Secondary). The single broadcast domain is partitioned into smaller broadcast sub- domains while keeping the existing Layer 3 configuration. When a VLAN is configured as a PVLAN, the PVLAN is referred to as the Primary VLAN, and any subsequent VLANs that are associated with the Primary VLAN are referred to as Secondary VLANs.","For example, consider an example where a single switch is used by different work groups. The users from different work groups are all connected to the same VLAN. Having all the users operating in the same VLAN domain can lead to compromise in data security and complexity in managing them. ","To isolate the users from each other, Secondary VLANs can be created for each work group under the Primary VLAN. The following diagram represents the scenario where W1, W2, and W3 are three different work groups sharing the same PVLAN. To isolate them from communicating with each other, they are assigned to individual Secondary VLANs. These Secondary VLANs cannot communicate with each other, except the PVLAN port. The PVLAN communicates with the promiscuous port and exchanges data with the respective Secondary VLANs.","Figure 4-4 :  Using Private VLANs","There are two types of Secondary VLANs:","•    ","Isolated VLAN—In an Isolated VLAN, all hosts connected to a member port are Isolated at Layer 2. They can communicate only with the promiscuous port of the Primary VLAN. There can be only one Isolated VLAN within one Primary VLAN.","•    ","Community VLAN—A Community VLAN is associated to a group of ports that connect to a certain “community” of end devices with mutual trust relationships. Any switch port associated with a common Community VLAN can communicate with each other and with the promiscuous ports of the Primary VLAN but not with any other Secondary VLAN. There can be multiple distinct Community VLANs within one Primary VLAN.","Private VLAN Ports","The ports with respect to PVLANs have different characteristics. The PVLAN port types are:","•    ","PVLAN Isolated Port—An isolated port cannot communicate with any other port in the PVLAN except for promiscuous ports. This is a physical port or link aggregation port that is associated with an Isolated Secondary VLAN at the port level. ","•    ","PVLAN Community Port—A community port can only communicate with a promiscuous port and other ports that are part of the same Community VLAN in the same Primary VLAN. This is a physical port or link aggregation port that is associated with only one Community Secondary VLAN at the port level. ","•    ","PVLAN Promiscuous Port—The promiscuous port can communicate with all the isolated ports and community ports in the Primary VLAN. This is a physical port or link aggregation that is associated with only one Primary VLAN at the port level.","•    ","PVLAN ISL Port—An inter-switch link port that extends a PVLAN domain across different switches by connecting Primary VLANs that belong to the same PVLAN domain. The ISL port carries both non-PVLAN traffic and Primary VLAN traffic between switches.","Quick Steps for Configuring PVLANs","The following steps provide a quick tutorial that creates a PVLAN. Also included are steps to define a Secondary VLAN for the PVLAN and assign ports to the PVLAN.","1    ","Create a PVLAN. Creating a PVLAN involves specifying a VLAN ID that is not already assigned to an existing VLAN. The specified VLAN ID will become the Primary VLAN for the PVLAN. For example, to create PVLAN 200 with the name “Corporate PVLAN” enter:","-> pvlan 200 name “Corporate PVLAN”","2    ","Enable the administrative state of PVLAN 200 by entering:","-> pvlan 200 admin-state enable","3    ","Create a Secondary VLAN and associate it to the Primary VLAN. Creating a Secondary VLAN involves specifying a VLAN ID that is not already assigned to an existing VLAN. The Secondary VLAN can be an Isolated VLAN or a Community VLAN depending on network requirements. For example, to create Isolated VLAN 250 and Community VLAN 251 and associate them to Primary VLAN 200, enter:","-> pvlan 200 secondary 250 type isolated","-> pvlan 200 secondary 251 type community","4    ","Associate the ports that will be part of the PVLAN. For example, to tag ports with Primary VLAN 200 and Secondary VLANs 250 and 251, enter:","-> pvlan 200 members port 1/1/1-3 tagged","-> pvlan 250 members port 1/1/10-12 tagged","-> pvlan 251 members port 1/1/20-22 tagged","Note.  ","Optional",". To verify the PVLAN configuration, use the ","show pvlan"," command. For example:","-> show pvlan","pvlan    type      admin   oper    mtu          name","------+----------+-------+------+------+------------------","200    Primary    Ena     Dis    1500   PVLAN 200","250    Isolated   Ena     Dis    1500   PVLAN 250","251    Community  Ena     Dis    1500   PVLAN 251","To verify the mapping of Secondary VLANs to a Primary VLAN, use the ","show pvlan mapping"," command. For example:","-> show pvlan mapping","Primary    Secondary","VLAN       VLAN       Type","----------+----------+------------","200        250        Isolated","200        251        Community","To verify the port assignments for the PVLAN, use the ","show pvlan members"," command. For example:","-> show pvlan members","pvlan   port      type               status       port-type","-------+---------+------------------+------------+------------","200     1/1       tagged             inactive     promiscuous","200     1/2       tagged             inactive     promiscuous","200     1/3       tagged             inactive     promiscuous","250     1/10      tagged             inactive     isolated","250     1/11      tagged             inactive     isolated","250     1/12      tagged             inactive     isolated","251     1/20      tagged             inactive     community","251     1/21      tagged             inactive     community","251     1/22      tagged             inactive     community","PVLAN Management Overview","The PVLAN feature provides the ability to create Secondary VLANs within a Primary VLAN. A regular VLAN usually represents a single broadcast domain. However, a PVLAN divides a VLAN (Primary) into sub-VLANs (Secondary) to partition the single broadcast domain into smaller broadcast sub-domains while keeping the existing Layer 3 configuration. ","The ports can be isolated from each other at the data link layer to improve security and performance and also simplify IP address assignment. The following PVLAN configuration tasks can be performed on the switch:","•    ","Create a Primary VLAN, see ","page 4-18",".","•    ","Create Secondary VLANs (Community or Isolated) to associate with a Primary VLAN, see ","page 4-19",".","•    ","Configure a user port or a link aggregate as a promiscuous port or ISL port for a Primary VLAN, see ","page 4-20",".","•    ","Associate the Secondary VLANs to user ports or link aggregates, see ","page 4-21",".","•    ","Verify the PVLAN configuration, see ","page 4-25",".","Creating PVLANs","Before creating a PVLAN, consider the following points:","•    ","A Primary VLAN ID is created first and represents the PVLAN domain. When any Secondary VLANs are created, the Primary VLAN ID must be specified to identify the PVLAN to which the Secondary VLAN is assigned.","•    ","The VLAN ID that is specified to create a Primary VLAN must ","not"," already exist in the system.","•    ","The following values are configurable only on the Primary VLAN but are also applied to all the Secondary VLANs that are associated with the Primary VLAN:","–    ","The administrative status for the PVLAN (enabled by default). When the status is changed for the Primary VLAN ID, the change is automatically applied to the Secondary VLANs.","–    ","The Spanning Tree status for the PVLAN (enabled by default). When the status is changed for the Primary VLAN ID, the change is automatically applied to the Secondary VLANs.","–    ","IP configuration for the PVLAN. An IP interface is configured on the Primary VLAN but is not configurable on Secondary VLANs.","•    ","Specifying a description for Primary and Secondary VLANs is optional. If one is not specified, then the VLAN ID is used as the description.","•    ","MVRP cannot be enabled on the PVLAN.","To create a Primary VLAN for the PVLAN, enter ","pvlan"," followed by a unique VLAN ID, an optional administrative status, and an optional description. For example, the following command creates Primary VLAN 200 with a description:","-> pvlan 200 admin-state enable name “Corporate PVLAN”","When configuring a description that contains multiple words that are separated by spaces, quotations marks are required. If the description consists of only one word or multiple words separated by another character (such as a hyphen), then quotation marks are not required.","You can also specify a range of VLAN IDs with the ","pvlan"," command. Use a hyphen to indicate a contiguous range. For example, the following commands create Primary VLANs 10 through 15 and 100 through 105 on the switch:","-> pvlan 10-15 100-105 name “Corporate PVLAN”","-> pvlan 100-105 name “Corporate PVLAN”","The maximum transfer unit (MTU) size can also be configured for the PVLAN when the PVLAN is created. For example, to set an MTU size of 64 KB for PVLAN 200, enter the following:","-> pvlan 200 mtu-ip 64","To remove a PVLAN from the switch configuration, use the ","no"," form of the ","pvlan"," command. For example, to remove PVLANs 10-15, 100-105, and 200, enter:","-> no pvlan 10-15","-> no pvlan 100-105","-> no pvlan 200","When the Primary VLAN for a PVLAN is deleted, any router interfaces defined for the PVLAN are removed and all VLAN port associations are dropped. ","To view a list of PVLANs already configured on the switch, use the ","show pvlan"," command. See ","“Verifying the PVLAN Configuration” on page 4-25"," for more information.","Enabling/Disabling the PVLAN Administrative Status","The administrative state of a PVLAN is enabled by default. To enable or disable the administrative status for an existing PVLAN, enter ","pvlan"," followed by an existing Primary VLAN ID and either"," admin-state enable"," or ","admin-state disable",". For example:","-> pvlan 200 admin-state enable","-> pvlan 200 admin-state disable","When the administrative status for the Primary VLAN of a PVLAN is changed, the following occurs:","•    ","The change is automatically made to any Secondary VLANs associated with the Primary VLAN.","•    ","PVLAN port assignments are retained but traffic is not forwarded on these ports if the administrative status is disabled.","Modifying the PVLAN Description","To change the description for the Primary VLAN of a PVLAN, enter ","pvlan"," followed by an existing VLAN ID and the keyword ","name"," followed by the new description (up to 32 characters). For example, the following command changes the description for Primary VLAN 200 to “Corporate IP Network”:","-> pvlan 455 name “Corporate IP Network”","Creating Secondary VLANs","Before creating Secondary VLANs for a PVLAN, consider the following points:","•    ","The VLAN ID used to configure the Secondary VLAN must ","not"," already exist in the system.","•    ","The Secondary VLAN can be created only after the Primary VLAN for the PVLAN is created.","•    ","There are two types of Secondary VLANs: Isolated and Community. Only one Isolated VLAN can be associated with a Primary VLAN, but multiple Community VLANs can be associated with the same Primary VLAN.","•    ","The administrative state of Secondary VLANs is derived from the administrative state of the Primary VLAN. ","•    ","The Spanning Tree state of Secondary VLANs is derived from the Spanning Tree state of the associated Primary VLAN.","•    ","MVRP cannot be enabled on a Secondary VLAN.","To create and associate a Secondary VLAN to a Primary VLAN, use the ","pvlan secondary"," command. For example, the following commands create Isolated and Community VLANs for Primary VLAN 200:","-> pvlan 200 secondary 250 type isolated","-> pvlan 200 secondary 251 type community","By default, the administrative status and the Spanning Tree status of the associated Primary VLAN is applied to both of the configured Secondary VLANs.","You can also specify a range of Secondary VLAN IDs when creating Community VLANs. Use a hyphen to indicate a contiguous range and a space to separate multiple VLAN ID entries. For example, the following command creates and associates Community VLANs 20 through 25 to Primary VLAN 200 on the switch:","-> pvlan 200 secondary 20-25 type community","Specifying a range of Secondary VLAN IDs is not allowed when creating Isolated VLANs. There is only one Isolated VLAN allowed for each Primary PVLAN.","To remove a Secondary VLAN from the PVLAN, use the ","no"," form of the ","pvlan secondary"," command. For example:","-> no pvlan 200 secondary 251","When a Secondary VLAN is deleted, the VLAN ID is removed and all VLAN port associations for that VLAN are dropped. ","To view the PVLAN mapping of Secondary VLANs configured on the switch, use the ","show pvlan mapping"," command. See ","“Verifying the PVLAN Configuration” on page 4-25"," for more information.","Assigning Ports to PVLANs","PVLAN offers Layer 2 data isolation between the devices on the same VLAN. For a PVLAN to operate, ports or link aggregates must be assigned to the PVLAN. The following port types are configurable for PVLANs:","•    ","Promiscuous Port","•    ","ISL Port","•    ","Isolated Port ","•    ","Community Port","An ISL port can only be assigned to a Primary VLAN. The other port types are determined based on the type of VLAN associated with the PVLAN to which the port is assigned. For example:","•    ","Ports assigned to a Primary PVLAN are designated as promiscuous ports.","•    ","Ports assigned to a Secondary VLAN configured as a Community VLAN are designated as community ports.","•    ","Ports assigned to a Secondary VLAN configured as an Isolated VLAN are designated as isolated ports.","The following table defines the communication criteria between the PVLAN port types:","Port Types","Isolated","Promiscuous","Community","ISL","Isolated","Deny","Permit","Deny"," ","Permit","Promiscuous","Permit","Permit","Permit","Permit","Community","Deny","Permit","Deny, except for ports that belong to the same Community.","Permit","ISL","Only PVLAN packets","Permit","Only PVLAN packets and the same Community VLAN packets","Permit","Configuring Promiscuous Ports","A PVLAN must have one promiscuous port associated with the Primary VLAN to communicate with all the community ports, isolated ports, and ISL ports.","A promiscuous port can be tagged or untagged based on the network requirements. ","To configure a promiscuous port, use the ","pvlan members"," command to assign a port or link aggregate as a tagged or untagged member of the Primary VLAN. For example:","-> pvlan 200 members port 1/1/1 tagged","In this example, the port 1/1/1 is assigned to Primary PVLAN 200, so the port is designated as a promiscuous port. When only a tagged VLAN-port association (VPA) is configured, then all untagged traffic is dropped on the port. ","To remove a promiscuous port from the Primary VLAN, use the ","no"," form of the ","pvlan members ","command. For example:","-> no pvlan 200 members port 1/1/1","Configuring ISL Ports","An Inter-Switch-Link (ISL) port connects a Primary VLAN on one switch to a Primary VLAN on another switch to extend the PVLAN domain across multiple switches. The ISL port carries Primary and Secondary VLAN traffic between switches throughout the PVLAN domain. Make sure that the Primary and Secondary VLAN configuration is the same across all the switches to ensure the traffic is forwarded correctly over the ISL connections.","To configure an ISL port, use the ","pvlan members"," command with the ","isl"," parameter option. For example, the following command configures port 1/1/2 as an ISL port for Primary VLAN 200:","-> pvlan 200 members port 1/1/2 isl","Note.  ","An ISL port can be configured only on the Primary VLAN, but the ISL port carries traffic for all VLANs associated with the PVLAN (Primary and Secondary).","To remove an ISL port from the Primary VLAN, use the ","no"," form of the ","pvlan members ","command. For example:","-> no pvlan 200 members port 1/1/2","Configuring Secondary VLAN Ports","The Secondary VLAN ports are defined as isolated or community ports based on the type of Secondary VLAN ID to which the ports are assigned. ","•    ","If a port is assigned to an Isolated Secondary VLAN, the port is designated as an isolated port.","•    ","If a port is assigned to a Community Secondary VLAN, the port is designated as a community port.","To configure an isolated port, use the ","pvlan members"," command to assign a port or link aggregate as a tagged or untagged member of an Isolated Secondary VLAN. For example, the following commands create Isolated VLAN 250 as a Secondary VLAN to Primary VLAN 200 and then assign port 1/2/2 and link aggregate 10 to VLAN 250:","-> pvlan 200 secondary 250 type isolated","-> pvlan 250 members port 1/2/2 tagged","-> pvlan 250 members linkagg 10 untagged","To configure a community port, use the ","pvlan members"," command to assign a port or link aggregate as a tagged or untagged member of a Community Secondary VLAN. For example, the following commands create Community VLAN 251 as a Secondary VLAN to Primary VLAN 200 and then assign port 1/2/5 and link aggregate 15 to VLAN 251:","-> pvlan 200 secondary 251 type isolated","-> pvlan 251 members port 1/2/5 tagged","-> pvlan 251 members linkagg 15 untagged","To remove a port from a Secondary VLAN, use the ","no"," form of the ","pvlan members ","command. For example, the following commands remove a port and link aggregate from Secondary VLAN 250 and 251:","-> no pvlan 250 members port 1/2/2","-> no pvlan 251 members linkagg 15","Assigning UNP Ports to Secondary VLANs","Universal Network Profile (UNP) ports can also be assigned to Secondary VLANs (isolated or community ports). The UNP ports are designated as isolated or community ports during runtime based on the first MAC address learned on the port. ","•    ","If the first MAC address is learned on a UNP port is classified into an Isolated VLAN, the port is designated as an isolated port. ","•    ","If the first MAC address is learned on a UNP port is classified into a Community VLAN, the port is designated as a community port. ","•    ","If the first MAC address learned on the a UNP port is classified into any standard VLAN (non-PVLAN), then the UNP port cannot be designated as an isolated or community port.","Protocol Configuration Requirements for PVLAN","This section contains important information about configuring other protocols to interact with PVLANs. For more information about each protocol, refer the related chapters in the ","OmniSwitch AOS Release 8 CLI Reference Guide"," and the ","OmniSwitch AOS Release 8 Network Configuration Guide",".","Enabling DHCP Snooping for PVLANs","DHCP Snooping can be enabled only on the Primary VLAN of a PVLAN configuration. When enabled on the Primary VLAN, the configuration will be applied to the Secondary VLANs associated with the Primary VLAN.","If the DHCP Snooping server is on another chassis, then the ISL port configured for communication must be configured as a trusted port.","Enabling Ingress Source Filtering (ISF) for PVLANs","ISF can be enabled only on the Primary VLAN of a PVLAN configuration. When enabled on the Primary VLAN, the configuration will be applied to the Secondary VLANs associated with the Primary VLAN.","Enabling IPMS for PVLANs","IPMS can be enabled only on the Primary VLAN of a PVLAN configuration.","Enabling STP for PVLANs","STP can be enabled only on the Primary VLAN of a PVLAN configuration. When enabled on the Primary VLAN, the configuration will be applied to the Secondary VLANs associated to the Primary VLAN. ","Note.  ","The PVLAN feature is supported only when the switch is running in the flat (MSTP) Spanning Tree mode; it is not supported in the per-VLAN mode.","Sample PVLAN Use Case","PVLAN Spanning across Multiple Systems","The following diagram shows how using a PVLAN configuration allows the traffic to be segmented at the Layer 2 level, thus limiting the broadcast domain and extending it across multiple switches.","Figure 4-5 :  PVLAN Spanning across Multiple Systems","The individual switches are separately configured with the PVLAN setup. IP interfaces are configured on the Primary VLAN, and the hosts in both the Isolated and Community VLAN can share the IP addresses from the same subnet but still remain isolated.","In this use case example, there are two Primary VLANs (100, 50) spanning across multiple OmniSwitch systems:","Primary VLAN: 100 (IP subnet: 10.10.100.x)","•    ","Community VLAN: 115","•    ","Isolated VLAN: 120","Primary VLAN: 50 (IP subnet: 10.10.50.x)","•    ","Isolated VLAN: 55","All the isolated, community, and promiscuous ports can be untagged or tagged. Since the PVLAN domain spans across multiple switches, an Inter-Switch Link (ISL) port is configured for each Primary VLAN on each switch to connect and carry traffic forwarded on the Primary VLANs.","The PVLAN traffic flow in this scenario is as follows:","•    ","Untagged traffic is passed into an untagged Secondary (community) port 1 on OmniSwitch-1. ","–    ","The traffic will be tagged with the PVID of the port which is Secondary VLAN. ","–    ","The ISL port will then carry the tagged traffic into the community port on the other switch (OmniSwitch-2:1, OmniSwitch-2:2). ","–    ","Traffic outgoing through the promiscuous port (OmniSwitch-3: P: 100) will modify the tag to Primary VLAN.","•    ","Tagged traffic is passed into an untagged Secondary (community) port","–    ","If the tag matches the PVID of the port, it will be allowed. ","–    ","The ISL port will then carry the tagged traffic into the community port on the other switch (OmniSwitch-2:1, OmniSwitch-2:2). ","–    ","Traffic outgoing through promiscuous port (OmniSwitch-3: P: 100) will modify the tag to Primary VLAN.","•    ","Untagged traffic passed into a tagged Secondary (community) port is dropped.","•    ","Tagged traffic passed into a tagged Secondary (community) port is dropped if the VLAN tag of the traffic does not match the VLAN tag of the port.","Verifying the PVLAN Configuration","To display information about the PVLAN configuration, use the ","show"," commands listed below:","show pvlan","Displays a list of PVLANs configured on the switch.","show pvlan mapping","Displays Primary PVLAN and Secondary PVLAN mapping. ","show pvlan members","Displays port associations (VPAs) for all or specific PVLANs. ","Use the ","show configuration snapshot"," command with the ","pvlan"," option to display the PVLAN configuration. For example:","-> show configuration snapshot pvlan","! PVLAN:","pvlan 300 admin-state enable","pvlan 300 secondary 20-25 type community","pvlan 300 members port 1/3/10 tagged","pvlan 300 members linkagg 10 tagged"]],"id":"9"})